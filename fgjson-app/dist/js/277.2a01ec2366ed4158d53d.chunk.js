(self.webpackChunkfgjson_app=self.webpackChunkfgjson_app||[]).push([[277],{63277:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>ar});var r=o(37101),i=o(45697),s=o.n(i),n=o(57557),a=o.n(n),l=o(2479);const p={locale:navigator&&navigator.language,formats:{},messages:{},defaultLocale:"en",defaultFormats:{},formatDate:e=>e,formatTime:e=>e,formatRelative:e=>e,formatNumber:e=>e,formatPlural:e=>e,formatMessage:e=>e,formatHTMLMessage:e=>e,now:()=>new Date};var h=o(37566),c=o(73800),u=o(86306),d=o(70878),m=o(78471),g=o(76773),y=o(18672),f=o(99937),v=o(40868),_=o(21915),w=o(94401),b=o(84110),C=o(44183),x=o(67294),S=o.n(x),P=o(27418),E=o.n(P),L=o(10312),T=o(54980),F=o(68105);var O=o(45801),I=o(18369),M=o(78516),G=o(52),k=o(48041),j=o(78653),Z=o(97950),N=o(52043),A=o(44538),D=o(52329),R=o(25642),V=o(13987),z=o(28795),B=o(32538),U=o(38667),W=function(e){function t(t,o,r){if(e.call(this),void 0!==r&&void 0===o)this.setFlatCoordinates(r,t);else{var i=o||0;this.setCenterAndRadius(t,i,r)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.clone=function(){return new t(this.flatCoordinates.slice(),void 0,this.layout)},t.prototype.closestPointXY=function(e,t,o,r){var i=this.flatCoordinates,s=e-i[0],n=t-i[1],a=s*s+n*n;if(a<r){if(0===a)for(var l=0;l<this.stride;++l)o[l]=i[l];else{var p=this.getRadius()/Math.sqrt(a);o[0]=i[0]+p*s,o[1]=i[1]+p*n;for(var h=2;h<this.stride;++h)o[h]=i[h]}return o.length=this.stride,a}return r},t.prototype.containsXY=function(e,t){var o=this.flatCoordinates,r=e-o[0],i=t-o[1];return r*r+i*i<=this.getRadiusSquared_()},t.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},t.prototype.computeExtent=function(e){var t=this.flatCoordinates,o=t[this.stride]-t[0];return(0,_.T9)(t[0]-o,t[1]-o,t[0]+o,t[1]+o,e)},t.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},t.prototype.getRadiusSquared_=function(){var e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t},t.prototype.getType=function(){return z.Z.CIRCLE},t.prototype.intersectsExtent=function(e){var t=this.getExtent();if((0,_.kK)(e,t)){var o=this.getCenter();return e[0]<=o[0]&&e[2]>=o[0]||e[1]<=o[1]&&e[3]>=o[1]||(0,_.H6)(e,this.intersectsCoordinate,this)}return!1},t.prototype.setCenter=function(e){var t=this.stride,o=this.flatCoordinates[t]-this.flatCoordinates[0],r=e.slice();r[t]=r[0]+o;for(var i=1;i<t;++i)r[t+i]=e[i];this.setFlatCoordinates(this.layout,r),this.changed()},t.prototype.setCenterAndRadius=function(e,t,o){this.setLayout(o,e,0),this.flatCoordinates||(this.flatCoordinates=[]);var r=this.flatCoordinates,i=(0,U.IG)(r,0,e,this.stride);r[i++]=r[0]+t;for(var s=1,n=this.stride;s<n;++s)r[i++]=r[s];r.length=i,this.changed()},t.prototype.getCoordinates=function(){return null},t.prototype.setCoordinates=function(e,t){},t.prototype.setRadius=function(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()},t}(B.ZP);W.prototype.transform;const H=W;var q=o(40353);const Y=({type:e,coordinates:t,radius:o,center:r}={})=>{let i;switch(e){case"Point":i=new N.Z(t||[]);break;case"LineString":i=new A.Z(t||[]);break;case"MultiPoint":i=new D.Z(t||[]);break;case"MultiLineString":i=new R.Z(t||[]);break;case"MultiPolygon":i=new V.Z(t||[]);break;default:i=o&&r?(0,q.Bb)(new H([r.x,r.y],o),100):new q.ZP(t||[])}return i},X={dragPan:{options:{kinetic:!1},Instance:c.Z},keyboardPan:{options:{kinetic:!1},Instance:O.Z},mouseWheelZoom:{options:{duration:0},Instance:u.Z},doubleClickZoom:{options:{duration:0},Instance:I.Z},shiftDragZoom:{options:{duration:0},Instance:M.Z},keyboardZoom:{options:{},Instance:G.Z},pinchZoom:{options:{duration:0},Instance:k.Z},pinchRotate:{options:{},Instance:j.Z},altShiftDragRotate:{options:{},Instance:Z.Z}};var K=o(18446),$=o.n(K),J=o(13311),Q=o.n(J),ee=o(23493),te=o.n(ee),oe=o(1469),re=o.n(oe),ie=o(14293),se=o.n(ie),ne=o(93379),ae=o.n(ne),le=o(91133);ae()(le.Z,{insert:"head",singleton:!1}),le.Z.locals;var pe=o(14976);function he(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}ae()(pe.Z,{insert:"head",singleton:!1}),pe.Z.locals;class ce extends S().Component{constructor(...e){super(...e),he(this,"getDocument",(()=>this.props.document||document)),he(this,"getResolutions",(()=>{if(this.props.mapOptions&&this.props.mapOptions.view&&this.props.mapOptions.view.resolutions)return this.props.mapOptions.view.resolutions;let e=void 0!==this.props.mapOptions.minZoom?this.props.mapOptions.minZoom:0,t=void 0!==this.props.mapOptions.maxZoom?this.props.mapOptions.maxZoom:28,o=void 0!==this.props.mapOptions.zoomFactor?this.props.mapOptions.zoomFactor:2;const r=this.map.getView().getProjection(),i=r.getExtent();let s,n,a=(i?(0,_.dz)(i):360*v.default.METERS_PER_UNIT[v.default.DEGREES]/v.default.METERS_PER_UNIT[r.getUnits()])/256,l=(i?(0,_.Cr)(i):360*v.default.METERS_PER_UNIT[v.default.DEGREES]/v.default.METERS_PER_UNIT[r.getUnits()])/256;a<=l?(s=1,n=Math.round(l/a),l/=n):(n=1,s=Math.round(a/l),a/=s);const p=Math.max(a,l),h=p/Math.pow(2,28);let c=this.props.mapOptions.maxResolution;void 0!==c?e=0:c=p/Math.pow(o,e);let u=this.props.mapOptions.minResolution;return void 0===u&&(u=void 0!==this.props.mapOptions.maxZoom?void 0!==this.props.mapOptions.maxResolution?c/Math.pow(o,t):p/Math.pow(o,t):h),t=e+Math.floor(Math.log(c/u)/Math.log(o)),Array.apply(0,Array(t-e+1)).map(((e,t)=>c/Math.pow(o,t)))})),he(this,"mouseMoveEvent",(e=>{if(!e.dragging&&e.coordinate){const t=this.map.get("elevationLayer")&&this.map.get("elevationLayer").get("getElevation");let o=e.coordinate.slice(),r=(0,y.bU)(o,this.props.projection),i=r[0]/360%1*360;i<-180?i+=360:i>180&&(i-=360),this.props.onMouseMove({y:r[1]||0,x:i||0,z:this.map.get("elevationLayer")&&this.map.get("elevationLayer").get("getElevation")(o,e.pixel)||void 0,crs:"EPSG:4326",pixel:{x:e.pixel[0],y:e.pixel[1]},latlng:{lat:r[1],lng:i,z:t&&t(o,e.pixel)||void 0},lat:r[1],lng:i,rawPos:e.coordinate.slice()})}})),he(this,"updateMapInfoState",(()=>{let e=this.map.getView(),t=e.getCenter(),o=e.getProjection().getExtent();const r=e.getProjection().getCode();if(-1!==["EPSG:3857","EPSG:900913","EPSG:4326"].indexOf(r)||t&&t[0]>=o[0]&&t[0]<=o[2]&&t[1]>=o[1]&&t[1]<=o[3]){let t=this.normalizeCenter(e.getCenter()),o=e.calculateExtent(this.map.getSize()),i={width:this.map.getSize()[0],height:this.map.getSize()[1]};this.props.onMapViewChanges({x:t[0]||0,y:t[1]||0,crs:"EPSG:4326"},e.getZoom(),{bounds:{minx:o[0],miny:o[1],maxx:o[2],maxy:o[3]},crs:r,rotation:e.getRotation()},i,this.props.id,this.props.projection,void 0,e.getResolution())}})),he(this,"haveResolutionsChanged",(e=>{const t=this.props.mapOptions&&this.props.mapOptions.view?this.props.mapOptions.view.resolutions:void 0,o=e.mapOptions&&e.mapOptions.view?e.mapOptions.view.resolutions:void 0;return!$()(t,o)})),he(this,"createView",((e,t,o,r,i={})=>{const s=i.restrictedExtent&&i.crs&&(0,L.reprojectBbox)(i.restrictedExtent,i.crs,(0,L.normalizeSRS)(o)),n=!r||r&&!r.view?E()({},r,{extent:s}):E()({},r),a=E()({},{projection:(0,L.normalizeSRS)(o),center:[e.x,e.y],zoom:t,minZoom:i.minZoom},n||{});return new g.ZP(a)})),he(this,"_updateMapPositionFromNewProps",(e=>{var t=this.map.getView();const o=this.props.center;if(e.center.y!==o.y||e.center.x!==o.x){let o=(0,L.reproject)({x:e.center.x,y:e.center.y},"EPSG:4326",e.projection,!0);t.setCenter([o.x,o.y])}Math.round(e.zoom)!==this.props.zoom&&t.setZoom(Math.round(e.zoom)),(e.bbox&&void 0!==e.bbox.rotation||this.bbox&&void 0!==this.bbox.rotation&&e.bbox.rotation!==this.props.bbox.rotation)&&t.setRotation(e.bbox.rotation)})),he(this,"normalizeCenter",(e=>{let t=(0,L.reproject)({x:e[0],y:e[1]},this.props.projection,"EPSG:4326",!0);return[t.x,t.y]})),he(this,"setMousePointer",(e=>{this.map&&(this.map.getViewport().style.cursor=e||"auto")})),he(this,"registerHooks",(()=>{this.props.hookRegister.registerHook(F.default.RESOLUTIONS_HOOK,(()=>this.getResolutions())),this.props.hookRegister.registerHook(F.default.RESOLUTION_HOOK,(()=>this.map.getView().getResolution())),this.props.hookRegister.registerHook(F.default.COMPUTE_BBOX_HOOK,((e,t)=>{var o=(0,L.reproject)([e.x,e.y],"EPSG:4326",this.props.projection);let r=this.createView(o,t,this.props.projection,this.props.mapOptions&&this.props.mapOptions.view,this.props.limits),i=this.map.getSize(),s=r.calculateExtent(i);return{bounds:{minx:s[0],miny:s[1],maxx:s[2],maxy:s[3]},crs:this.props.projection,rotation:this.map.getView().getRotation()}})),this.props.hookRegister.registerHook(F.default.GET_PIXEL_FROM_COORDINATES_HOOK,(e=>this.map.getPixelFromCoordinate(e))),this.props.hookRegister.registerHook(F.default.GET_COORDINATES_FROM_PIXEL_HOOK,(e=>this.map.getCoordinateFromPixel(e))),this.props.hookRegister.registerHook(F.default.ZOOM_TO_EXTENT_HOOK,((e,{padding:t,crs:o,maxZoom:r,duration:i,nearest:s}={})=>{let n=(0,L.reprojectBbox)(e,o,this.props.projection);n&&n[0]===n[2]&&n[1]===n[3]&&"EPSG:4326"===o&&re()(e)&&-180===e[0]&&-90===e[1]&&(n=this.map.getView().getProjection().getExtent());let a=r;n&&n[0]===n[2]&&n[1]===n[3]&&se()(a)&&(a=21),this.map.getView().fit(n,{size:this.map.getSize(),padding:t&&[t.top||0,t.right||0,t.bottom||0,t.left||0],maxZoom:a,duration:i,nearest:s})}))}))}componentDidMount(){this.props.projectionDefs.forEach((e=>{const t=w.default.defs(e.code);var o,r,i,s,n;o=e.code,r=e.extent,i=e.worldExtent,s=e.axisOrientation||t.axis||"enu",n=t.units||"m",(0,y.Sx)(new C.Z({code:o,extent:r,worldExtent:i,axisOrientation:s,units:n}))}));let e=(0,L.reproject)([this.props.center.x,this.props.center.y],"EPSG:4326",this.props.projection);!function(e){var t,o,r=Object.keys(e.defs),i=r.length;for(t=0;t<i;++t){var s=r[t];if(!(0,y.U2)(s)){var n=e.defs(s);(0,y.Sx)(new C.Z({code:s,axisOrientation:n.axis,metersPerUnit:n.to_meter,units:n.units}))}}for(t=0;t<i;++t){var a=r[t],l=(0,y.U2)(a);for(o=0;o<i;++o){var p=r[o],h=(0,y.U2)(p);if(!(0,b.U2)(a,p))if(e.defs[a]===e.defs[p])(0,y.rM)([l,h]);else{var c=e(a,p);(0,y.zY)(l,h,c.forward,c.inverse)}}}}(w.default);let t=E()(this.props.interactive?{}:{doubleClickZoom:!1,dragPan:!1,altShiftDragRotate:!1,keyboard:!1,mouseWheelZoom:!1,shiftDragZoom:!1,pinchRotate:!1,pinchZoom:!1},this.props.mapOptions.interactions),o=(0,h.ce)(E()({dragPan:!1,mouseWheelZoom:!1},t,{}));void 0!==t&&void 0!==t.dragPan||(this.dragPanInteraction=new c.Z({kinetic:!1}),o.extend([this.dragPanInteraction])),void 0!==t&&void 0!==t.mouseWheelZoom||(this.mouseWheelInteraction=new u.Z({duration:0}),o.extend([this.mouseWheelInteraction]));let r=(0,d.c)(E()({zoom:this.props.zoomControl,attributionOptions:E()({collapsible:!1},this.props.mapOptions.attribution&&this.props.mapOptions.attribution.container?{target:this.getDocument().querySelector(this.props.mapOptions.attribution.container)}:{})},this.props.mapOptions.controls)),i=new m.default({layers:[],controls:r,interactions:o,maxTilesLoading:1/0,target:this.getDocument().getElementById(this.props.id)||`${this.props.id}`,view:this.createView(e,Math.round(this.props.zoom),this.props.projection,this.props.mapOptions&&this.props.mapOptions.view,this.props.limits)});this.map=i,this.props.registerHooks&&this.registerHooks(),this.map.disabledListeners={},this.map.disableEventListener=e=>{this.map.disabledListeners[e]=!0},this.map.enableEventListener=e=>{delete this.map.disabledListeners[e]},this.map.getViewport().addEventListener("mouseout",(()=>{setTimeout((()=>this.props.onMouseOut()),150)})),i.on("moveend",this.updateMapInfoState),i.on("singleclick",(e=>{if(this.props.onClick&&!this.map.disabledListeners.singleclick){let t=this.map.getView(),o=e.coordinate.slice(),r=t.getProjection().getExtent();if("EPSG:4326"===this.props.projection&&(o[0]=(0,L.normalizeLng)(o[0])),"EPSG:900913"!==this.props.projection&&"EPSG:3857"!==this.props.projection||(o=(0,y.bU)(o,this.props.projection),r=(0,L.reprojectBbox)(r,this.props.projection,"EPSG:4326")),o[0]>=r[0]&&o[0]<=r[2]&&o[1]>=r[1]&&o[1]<=r[3]){let t,r;t="EPSG:900913"!==this.props.projection&&"EPSG:3857"!==this.props.projection?(0,L.reproject)(o,this.props.projection,"EPSG:4326"):{x:o[0],y:o[1]},this.markerPresent=!1,i.forEachFeatureAtPixel(e.pixel,((e,o)=>{if(o&&o.get("handleClickOnLayer")){const i=e.getGeometry();if(!this.markerPresent&&"Point"===i.getType()){this.markerPresent=!0,r=o.get("msId");const e=(0,y.bU)(i.getFirstCoordinate(),this.props.projection);t={x:e[0],y:e[1]}}}}));const s=(0,L.normalizeLng)(t.x),n=this.map.get("elevationLayer")&&this.map.get("elevationLayer").get("getElevation");this.props.onClick({pixel:{x:e.pixel[0],y:e.pixel[1]},latlng:{lat:t.y,lng:s,z:n&&n(o,e.pixel)||void 0},rawPos:e.coordinate.slice(),modifiers:{alt:e.originalEvent.altKey,ctrl:e.originalEvent.ctrlKey,metaKey:e.originalEvent.metaKey,shift:e.originalEvent.shiftKey}},r)}}}));const s=te()(this.mouseMoveEvent,100);i.on("pointermove",s),this.updateMapInfoState(),this.setMousePointer(this.props.mousePointer),this.forceUpdate(),this.props.onResolutionsChange(this.getResolutions())}UNSAFE_componentWillReceiveProps(e){if(e.mousePointer!==this.props.mousePointer&&this.setMousePointer(e.mousePointer),e.zoomControl!==this.props.zoomControl&&(e.zoomControl?this.map.addControl(new f.Z):this.map.removeControl(this.map.getControls().getArray().filter((e=>e instanceof f.Z))[0])),this.map&&(this.props.mapOptions&&this.props.mapOptions.interactions)!==(e.mapOptions&&e.mapOptions.interactions)){const t=e.mapOptions.interactions||{},o=this.map.getInteractions().getArray();Object.keys(t).forEach((e=>{const{Instance:r,options:i}=X[e]||{};let s=Q()(o,(t=>X[e]&&t instanceof r));s?s.setActive(t[e]):t[e]&&r&&this.map.addInteraction(new r(i))}))}if(this.map&&this.props.id!==e.mapStateSource&&this._updateMapPositionFromNewProps(e),this.map&&e.resize!==this.props.resize&&setTimeout((()=>{this.map.updateSize()}),0),this.map&&(this.props.projection!==e.projection||this.haveResolutionsChanged(e))||this.props.limits!==e.limits){if(this.props.projection!==e.projection||this.props.limits!==e.limits){let t=e.projection;const o=(0,L.reproject)([e.center.x,e.center.y],"EPSG:4326",t);this.map.setView(this.createView(o,e.zoom,e.projection,e.mapOptions&&e.mapOptions.view,e.limits)),this.props.onResolutionsChange(this.getResolutions())}this.map.getLayers().forEach((e=>{let t=e.getSource();t.getTileLoadFunction&&t.setTileLoadFunction(t.getTileLoadFunction())})),this.map.render()}}componentWillUnmount(){const e=this.props.mapOptions.attribution&&this.props.mapOptions.attribution.container&&this.getDocument().querySelector(this.props.mapOptions.attribution.container);if(e&&e.querySelector(".ol-attribution"))try{e.removeChild(e.querySelector(".ol-attribution"))}catch(e){}this.map&&this.map.setTarget(null)}render(){const e=this.map,t=e?S().Children.map(this.props.children,(t=>t?S().cloneElement(t,{map:e,mapId:this.props.id,onLayerLoading:this.props.onLayerLoading,onLayerError:this.props.onLayerError,onLayerLoad:this.props.onLayerLoad,projection:this.props.projection,onCreationError:this.props.onCreationError,resolutions:this.getResolutions()}):null)):null;return S().createElement("div",{id:this.props.id,style:this.props.style},t)}}he(ce,"propTypes",{id:s().string,document:s().object,style:s().object,center:T.ZP.PropTypes.center,zoom:s().number.isRequired,mapStateSource:T.ZP.PropTypes.mapStateSource,projection:s().string,projectionDefs:s().array,onMapViewChanges:s().func,onResolutionsChange:s().func,onClick:s().func,mapOptions:s().object,zoomControl:s().bool,mousePointer:s().string,onMouseMove:s().func,onLayerLoading:s().func,onLayerLoad:s().func,onLayerError:s().func,resize:s().number,measurement:s().object,changeMeasurementState:s().func,registerHooks:s().bool,hookRegister:s().object,interactive:s().bool,onCreationError:s().func,bbox:s().object,wpsBounds:s().object,onWarning:s().func,maxExtent:s().array,limits:s().object,onMouseOut:s().func}),he(ce,"defaultProps",{id:"map",onMapViewChanges:()=>{},onResolutionsChange:()=>{},onCreationError:()=>{},onClick:null,onMouseMove:()=>{},mapOptions:{},projection:"EPSG:3857",projectionDefs:[],onLayerLoading:()=>{},onLayerLoad:()=>{},onLayerError:()=>{},resize:0,registerHooks:!0,hookRegister:F.default,interactive:!0,onMouseOut:()=>{},center:{x:13,y:45,crs:"EPSG:4326"},zoom:5});const ue=ce;var de=o(40392),me=o(89255),ge=o(81763),ye=o.n(ge);function fe(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class ve extends S().Component{constructor(...e){super(...e),fe(this,"setLayerVisibility",(e=>{const t=this.props.options&&!1!==this.props.options.visibility,o=e.options&&!1!==e.options.visibility;o!==t&&this.layer&&this.isValid()&&this.layer.setVisible(o)})),fe(this,"setLayerOpacity",(e=>{e!==(this.props.options&&void 0!==this.props.options.opacity?this.props.options.opacity:1)&&this.layer&&this.layer.setOpacity(e)})),fe(this,"generateOpts",((e,t,o,r,i,s)=>{const{minResolution:n,maxResolution:a,disableResolutionLimits:l,...p}=e,h={...p,...!l&&{minResolution:n,maxResolution:a,minZoom:se()(a)?void 0:(0,F.getZoomFromResolution)(a,s),maxZoom:se()(n)?void 0:(0,F.getZoomFromResolution)(n,s)}};return E()({},h,ye()(t)?{zIndex:t}:null,{srs:o,onError:()=>{this.props.onCreationError(h)},securityToken:r,env:i})})),fe(this,"createLayer",((e,t,o,r,i,s)=>{if(e){const n=this.generateOpts(t,o,(0,L.normalizeSRS)(this.props.srs),r,i,s);this.layer=de.default.createLayer(e,n,this.props.map,this.props.mapId);const a=de.default.isCompatible(e,n);if(this.layer&&!this.layer.detached){const e=this.props.map,o=e&&e.getView().getProjection().getExtent(),r=t&&t.bbox&&t.bbox.bounds,i=o&&(0,L.reprojectBbox)(o,this.props.srs,"EPSG:4326");let s=r&&(0,L.reprojectBbox)((0,L.getExtentFromNormalized)(r,this.props.srs).extent,"EPSG:4326");s&&2===s.length&&re()(s[1])&&(s=s[1]),(i&&s&&!(0,L.isBboxCompatible)((0,L.getPolygonFromExtent)(i),(0,L.getPolygonFromExtent)(s))||!a)&&this.props.onWarning({title:"warning",message:"notification.incompatibleDataAndProjection",action:{label:"close"},position:"tc",uid:"1"}),this.addLayer(t)}this.layer&&this.layer.get&&this.layer.get("getElevation")&&this.props.map.set("elevationLayer",this.layer),this.forceUpdate()}})),fe(this,"updateLayer",((e,t)=>{if(e.position===t.position&&e.srs===t.srs&&e.securityToken===t.securityToken){if(e.options===t.options)return;if($()(a()(e.options,["loading"]),a()(t.options,["loading"])))return}const o=de.default.updateLayer(this.props.type,this.layer,this.generateOpts(e.options,e.position,e.projection,e.securityToken,e.env,e.resolutions),this.generateOpts(t.options,t.position,t.projection,t.securityToken,t.env,t.resolutions),this.props.map,this.props.mapId);o&&(this.props.map.removeLayer(this.layer),this.layer=o,this.addLayer(e.options))})),fe(this,"addLayer",(e=>{if(this.isValid()){this.props.map.addLayer(this.layer);const t=new me.xQ,o=new me.xQ;e.handleClickOnLayer&&this.layer.set("handleClickOnLayer",!0),this.layer.getSource().on("tileloadstart",(()=>{0===this.tilestoload?(this.props.onLayerLoading(e.id),this.tilestoload++):this.tilestoload++})),this.layer.getSource().on("tileloadend",(()=>{t.next({type:"tileloadend"}),this.tilestoload--,0===this.tilestoload&&o.next()})),this.layer.getSource().on("tileloaderror",(e=>{t.next({type:"tileloaderror",event:e}),this.tilestoload--,0===this.tilestoload&&o.next()})),t.bufferWhen((()=>o)).subscribe({next:t=>{const o=t.filter((e=>"tileloaderror"===e.type));o.length>0&&(e&&!e.hideErrors||!e)?(this.props.onLayerLoad(e.id,{error:!0}),this.props.onLayerError(e.id,t.length,o.length)):this.props.onLayerLoad(e.id)}}),this.tileLoadEndStream$=t,this.tileStopStream$=o;const r=new me.xQ,i=new me.xQ;if(this.layer.getSource().on("imageloadstart",(()=>{0===this.imagestoload?(this.props.onLayerLoading(e.id),this.imagestoload++):this.imagestoload++})),this.layer.getSource().on("imageloadend",(()=>{this.imagestoload--,r.next({type:"imageloadend"}),0===this.imagestoload&&i.next()})),this.layer.getSource().on("imageloaderror",(e=>{this.imagestoload--,r.next({type:"imageloaderror",event:e}),0===this.imagestoload&&i.next()})),r.bufferWhen((()=>i)).subscribe({next:t=>{const o=t.filter((e=>"imageloaderror"===e.type));o.length>0?(this.props.onLayerLoad(e.id,{error:!0}),(e&&!e.hideErrors||!e)&&this.props.onLayerError(e.id,t.length,o.length)):this.props.onLayerLoad(e.id)}}),this.imageLoadEndStream$=r,this.imageStopStream$=i,this.layer.getSource().on("vectorerror",(()=>{this.props.onLayerLoad(e.id,{error:!0})})),e.refresh){let t=0;this.refreshTimer=setInterval((()=>{this.layer.getSource().updateParams(E()({},e.params,{_refreshCounter:t++}))}),e.refresh)}}})),fe(this,"isValid",(()=>{const e=de.default.isValid(this.props.type,this.layer);return this.valid=e,e}))}componentDidMount(){this.valid=!0,this.tilestoload=0,this.imagestoload=0,this.createLayer(this.props.type,this.props.options,this.props.position,this.props.securityToken,this.props.env,this.props.resolutions)}UNSAFE_componentWillReceiveProps(e){this.setLayerVisibility(e);const t=e.options&&void 0!==e.options.opacity?e.options.opacity:1;this.setLayerOpacity(t),e.position!==this.props.position&&this.layer&&this.layer.setZIndex&&this.layer.setZIndex(e.position),this.props.options&&this.updateLayer(e,this.props)}componentWillUnmount(){this.layer&&this.props.map&&(this.tileLoadEndStream$&&(this.tileLoadEndStream$.complete(),this.tileStopStream$.complete(),this.imageLoadEndStream$.complete(),this.imageStopStream$.complete()),this.layer.detached?this.layer.remove():this.props.map.removeLayer(this.layer)),this.refreshTimer&&clearInterval(this.refreshTimer),de.default.removeLayer(this.props.type,this.props.options,this.props.map,this.props.mapId,this.layer)}render(){if(this.props.children){const e=this.layer,t=e?S().Children.map(this.props.children,(t=>t?S().cloneElement(t,{container:e,styleName:this.props.options&&this.props.options.styleName}):null)):null;return S().createElement(S().Fragment,null,t)}return de.default.renderLayer(this.props.type,this.props.options,this.props.map,this.props.mapId,this.layer)}}fe(ve,"propTypes",{onWarning:s().func,maxExtent:s().array,map:s().object,mapId:s().string,srs:s().string,type:s().string,options:s().object,onLayerLoading:s().func,onLayerError:s().func,onCreationError:s().func,onLayerLoad:s().func,position:s().number,observables:s().array,securityToken:s().string,env:s().array,resolutions:s().array}),fe(ve,"defaultProps",{observables:[],onLayerLoading:()=>{},onLayerLoad:()=>{},onLayerError:()=>{},onCreationError:()=>{},onWarning:()=>{},srs:"EPSG:3857"});var _e=o(9669),we=o.n(_e),be=o(52353),Ce=o.n(be),xe=o(84596),Se=o.n(xe),Pe=o(80034);const Ee=(e,t,o=t)=>{if(!e.getGeometry()||"Polygon"!==e.getGeometry().getType()||e.getProperties().center&&0===e.getProperties().center.length)return e;if(e.getProperties()&&e.getProperties().isCircle&&e.getProperties().center&&e.getProperties().center[0]&&e.getProperties().center[1]){const r=e.getGeometry().getExtent();let i;e.getProperties().center?(i=(0,L.reproject)(e.getProperties().center,"EPSG:4326",t),i=[i.x,i.y]):i=(0,_.qg)(r);const s=e.getProperties().crs===t?e.getProperties().radius:((e,t,o,r)=>{if(re()(t)&&re()(t[0])&&re()(t[0][0])){const i=(0,L.reproject)(t[0][0],r,o);return Math.sqrt(Math.pow(e[0]-i.x,2)+Math.pow(e[1]-i.y,2))}return 100})(i,e.getGeometry().getCoordinates(),t,o);return e.setGeometry(new H(i,s)),e}return e};var Le=o(79055),Te=o(69141);function Fe(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class Oe extends S().Component{constructor(...e){super(...e),Fe(this,"addFeatures",(e=>{const t=new Te.Z;let o=null,r=!1;"FeatureCollection"===e.type?(o={features:Ce()(e.properties.visibility)||e.properties.visibility?e.features:[]},r=!!e.features):(o={geometry:e.geometry},r=!(!e.geometry||!e.geometry.geometries&&!e.geometry.coordinates)),e.container&&r&&(this._feature=t.readFeatures({type:e.type,properties:e.properties,id:e.msId,...o},{dataProjection:e.featuresCrs}),this._feature.map((t=>{let o=t;return t.getProperties().isCircle&&(o=Ee(t,e.crs||"EPSG:3857",e.featuresCrs),o.setGeometry(o.getGeometry().transform(e.crs||"EPSG:3857",e.featuresCrs))),o})).forEach((t=>t.getGeometry().transform(e.featuresCrs,e.crs||"EPSG:3857"))),e.style&&e.style!==e.layerStyle&&this._feature.forEach((t=>{let o=[],r={};"FeatureCollection"===e.type?(r=Q()(e.features,(e=>e.properties.id===t.getProperties().id)),o=(0,Le.createStylesAsync)(Se()(r.style))):(o=(0,Le.createStylesAsync)(Se()(e.style)),r={type:e.type,geometry:e.geometry,properties:e.properties,style:e.style}),we().all(o).then((e=>{t.setStyle((()=>(0,Pe.Cw)({...r,style:e})))}))})),e.container.getSource().addFeatures(this._feature))})),Fe(this,"removeFromContainer",(()=>{if(this._feature)if(Array.isArray(this._feature)){const e=this.props.container.getSource();this._feature.map((t=>{let o=t.getId();void 0!==o&&e.getFeatureById(o)?e.removeFeature(e.getFeatureById(o)):e.removeFeature(t)}))}else this.props.container.getSource().removeFeature(this._feature)}))}componentDidMount(){this.addFeatures(this.props)}shouldComponentUpdate(e){return!($()(e.properties,this.props.properties)&&$()(e.geometry,this.props.geometry)&&$()(e.features,this.props.features)&&$()(e.crs,this.props.crs)&&$()(e.style,this.props.style))}UNSAFE_componentWillUpdate(e){this.removeFromContainer(),this.addFeatures(e)}componentWillUnmount(){this.removeFromContainer()}render(){return null}}Fe(Oe,"propTypes",{type:s().string,layerStyle:s().object,style:s().object,properties:s().object,crs:s().string,container:s().object,features:s().array,geometry:s().object,msId:s().oneOfType([s().string,s().number]),featuresCrs:s().string}),Fe(Oe,"defaultProps",{featuresCrs:"EPSG:4326"});var Ie=o(59854),Me=o.n(Ie),Ge=o(27361),ke=o.n(Ge),je=o(43624),Ze=o.n(je),Ne=o(10928),Ae=o.n(Ne),De=o(39859),Re=o(94310),Ve=o(99677),ze=o(93409),Be=o(97016),Ue=o(29902),We=o(23068),He=o(31219),qe=o(98185),Ye=o(20767),Xe=o(9371),Ke=o(73381),$e=o(30006),Je=o(86968),Qe=o(58493),et=o(90728),tt=o(13002),ot=o(9520),rt=o(36403),it=o(64011),st=o(14303),nt=o(38024),at=o(73604),lt="Point",pt="LineString",ht="Polygon",ct="Circle",ut="drawstart",dt=function(e){function t(t,o){e.call(this,t),this.feature=o}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(ot.ZP);const mt=function(e){function t(t){var o=t;o.stopDown||(o.stopDown=it.Dv),e.call(this,o),this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.freehand_=!1,this.source_=t.source?t.source:null,this.features_=t.features?t.features:null,this.snapTolerance_=t.snapTolerance?t.snapTolerance:12,this.type_=t.type,this.mode_=function(e){var t;return e===z.Z.POINT||e===z.Z.MULTI_POINT?t=lt:e===z.Z.LINE_STRING||e===z.Z.MULTI_LINE_STRING?t=pt:e===z.Z.POLYGON||e===z.Z.MULTI_POLYGON?t=ht:e===z.Z.CIRCLE&&(t=ct),t}(this.type_),this.stopClick_=!!t.stopClick,this.minPoints_=t.minPoints?t.minPoints:this.mode_===ht?3:2,this.maxPoints_=t.maxPoints?t.maxPoints:1/0,this.finishCondition_=t.finishCondition?t.finishCondition:it.uX;var r,i=t.geometryFunction;if(!i)if(this.type_===z.Z.CIRCLE)i=function(e,t){var o=t||new H([NaN,NaN]),r=(0,et.bI)(e[0],e[1]);return o.setCenterAndRadius(e[0],Math.sqrt(r)),o};else{var s,n=this.mode_;n===lt?s=N.Z:n===pt?s=A.Z:n===ht&&(s=q.ZP),i=function(e,t){var o=t;return o?n===ht?e[0].length?o.setCoordinates([e[0].concat([e[0][0]])]):o.setCoordinates([]):o.setCoordinates(e):o=new s(e),o}}this.geometryFunction_=i,this.dragVertexDelay_=void 0!==t.dragVertexDelay?t.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,this.overlay_=new Ue.Z({source:new Be.Z({useSpatialIndex:!1,wrapX:!!t.wrapX&&t.wrapX}),style:t.style?t.style:(r=(0,He.createEditingStyle)(),function(e,t){return r[e.getGeometry().getType()]}),updateWhileInteracting:!0}),this.geometryName_=t.geometryName,this.condition_=t.condition?t.condition:rt.rM,this.freehandCondition_,t.freehand?this.freehandCondition_=rt.Bx:this.freehandCondition_=t.freehandCondition?t.freehandCondition:rt.vY,(0,tt.oL)(this,(0,Qe.v_)(at.Z.ACTIVE),this.updateState_,this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setMap=function(t){e.prototype.setMap.call(this,t),this.updateState_()},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleEvent=function(t){t.originalEvent.type===Ke.Z.CONTEXTMENU&&t.preventDefault(),this.freehand_=this.mode_!==lt&&this.freehandCondition_(t);var o=t.type===$e.Z.POINTERMOVE,r=!0;return!this.freehand_&&this.lastDragTime_&&t.type===$e.Z.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,o=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&t.type===$e.Z.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(t),r=!1):this.freehand_&&t.type===$e.Z.POINTERDOWN?r=!1:o?(r=t.type===$e.Z.POINTERMOVE)&&this.freehand_?r=this.handlePointerMove_(t):(t.pointerEvent.pointerType==st.T2||t.type===$e.Z.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(t):t.type===$e.Z.DBLCLICK&&(r=!1),e.prototype.handleEvent.call(this,t)&&r},t.prototype.handleDownEvent=function(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e),!0):!!this.condition_(e)&&(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new Je.Z($e.Z.POINTERMOVE,e.map,e.pointerEvent,!1,e.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=e.pixel,!0)},t.prototype.handleUpEvent=function(e){var t=!0;this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);var o=this.mode_===ct;return this.shouldHandle_?(this.finishCoordinate_?this.freehand_||o?this.finishDrawing():this.atFinish_(e)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e):(this.startDrawing_(e),this.mode_===lt&&this.finishDrawing()),t=!1):this.freehand_&&(this.finishCoordinate_=null,this.abortDrawing_()),!t&&this.stopClick_&&e.stopPropagation(),t},t.prototype.handlePointerMove_=function(e){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var t=this.downPx_,o=e.pixel,r=t[0]-o[0],i=t[1]-o[1],s=r*r+i*i;if(this.shouldHandle_=this.freehand_?s>this.squaredClickTolerance_:s<=this.squaredClickTolerance_,!this.shouldHandle_)return!0}return this.finishCoordinate_?this.modifyDrawing_(e):this.createOrUpdateSketchPoint_(e),!0},t.prototype.atFinish_=function(e){var t=!1;if(this.sketchFeature_){var o=!1,r=[this.finishCoordinate_];if(this.mode_===pt)o=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===ht){var i=this.sketchCoords_;o=i[0].length>this.minPoints_,r=[i[0][0],i[0][i[0].length-2]]}if(o)for(var s=e.map,n=0,a=r.length;n<a;n++){var l=r[n],p=s.getPixelFromCoordinate(l),h=e.pixel,c=h[0]-p[0],u=h[1]-p[1],d=this.freehand_?1:this.snapTolerance_;if(t=Math.sqrt(c*c+u*u)<=d){this.finishCoordinate_=l;break}}}return t},t.prototype.createOrUpdateSketchPoint_=function(e){var t=e.coordinate.slice();this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(t):(this.sketchPoint_=new We.Z(new N.Z(t)),this.updateSketchFeatures_())},t.prototype.startDrawing_=function(e){var t=e.coordinate;this.finishCoordinate_=t,this.mode_===lt?this.sketchCoords_=t.slice():this.mode_===ht?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new We.Z(new A.Z(this.sketchLineCoords_)));var o=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new We.Z,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(o),this.updateSketchFeatures_(),this.dispatchEvent(new dt(ut,this.sketchFeature_))},t.prototype.modifyDrawing_=function(e){var t,o,r,i=e.coordinate,s=this.sketchFeature_.getGeometry();if(this.mode_===lt?o=this.sketchCoords_:this.mode_===ht?(o=(t=this.sketchCoords_[0])[t.length-1],this.atFinish_(e)&&(i=this.finishCoordinate_.slice())):o=(t=this.sketchCoords_)[t.length-1],o[0]=i[0],o[1]=i[1],this.geometryFunction_(this.sketchCoords_,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(i),s.getType()==z.Z.POLYGON&&this.mode_!==ht){this.sketchLine_||(this.sketchLine_=new We.Z);var n=s.getLinearRing(0);(r=this.sketchLine_.getGeometry())?(r.setFlatCoordinates(n.getLayout(),n.getFlatCoordinates()),r.changed()):(r=new A.Z(n.getFlatCoordinates(),n.getLayout()),this.sketchLine_.setGeometry(r))}else this.sketchLineCoords_&&(r=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()},t.prototype.addToDrawing_=function(e){var t,o,r=e.coordinate,i=this.sketchFeature_.getGeometry();this.mode_===pt?(this.finishCoordinate_=r.slice(),(o=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?o.pop():t=!0),o.push(r.slice()),this.geometryFunction_(o,i)):this.mode_===ht&&((o=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?o.pop():t=!0),o.push(r.slice()),t&&(this.finishCoordinate_=o[0]),this.geometryFunction_(this.sketchCoords_,i)),this.updateSketchFeatures_(),t&&this.finishDrawing()},t.prototype.removeLastPoint=function(){if(this.sketchFeature_){var e,t=this.sketchFeature_.getGeometry();this.mode_===pt?((e=this.sketchCoords_).splice(-2,1),this.geometryFunction_(e,t),e.length>=2&&(this.finishCoordinate_=e[e.length-2].slice())):this.mode_===ht&&((e=this.sketchCoords_[0]).splice(-2,1),this.sketchLine_.getGeometry().setCoordinates(e),this.geometryFunction_(this.sketchCoords_,t)),0===e.length&&(this.finishCoordinate_=null),this.updateSketchFeatures_()}},t.prototype.finishDrawing=function(){var e=this.abortDrawing_();if(e){var t=this.sketchCoords_,o=e.getGeometry();this.mode_===pt?(t.pop(),this.geometryFunction_(t,o)):this.mode_===ht&&(t[0].pop(),this.geometryFunction_(t,o),t=o.getCoordinates()),this.type_===z.Z.MULTI_POINT?e.setGeometry(new D.Z([t])):this.type_===z.Z.MULTI_LINE_STRING?e.setGeometry(new R.Z([t])):this.type_===z.Z.MULTI_POLYGON&&e.setGeometry(new V.Z([t])),this.dispatchEvent(new dt("drawend",e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}},t.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var e=this.sketchFeature_;return e&&(this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0)),e},t.prototype.extend=function(e){var t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();var o=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=o.slice(),this.sketchCoords_.push(o.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new dt(ut,this.sketchFeature_))},t.prototype.updateSketchFeatures_=function(){var e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);var t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)},t.prototype.updateState_=function(){var e=this.getMap(),t=this.getActive();e&&t||this.abortDrawing_(),this.overlay_.setMap(t?e:null)},t}(nt.Z);var gt=o(56834),yt=o(70295);function ft(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const vt=e=>e.getView().getProjection().getCode();class _t extends S().Component{constructor(...e){super(...e),ft(this,"getLength",((e,t)=>{if("Bearing"===t.measurement.geomType&&e.length>1)return(0,L.calculateAzimuth)(e[0],e[1],vt(t.map));const o=this.reprojectedCoordinatesIn4326(e);return(0,L.calculateDistance)(o,t.measurement.lengthFormula)})),ft(this,"getArea",(e=>this.calculateGeodesicArea(e.getLinearRing(0).getCoordinates()))),ft(this,"updateInteraction",((e,t)=>{t.some((e=>ke()(e,"properties.disabled")))?this.removeDrawInteraction():null===this.drawInteraction&&(this.restoreDrawState(),this.addDrawInteraction(e))})),ft(this,"convertPolyToLineFeature",((e=[])=>{let t=[];const o=(0,De.wd)(e[0]);return o&&(0,De.wd)(e[1])?t=this.reprojectedCoordinatesFrom4326([e[0],e[1]]):o&&(t=this.reprojectedCoordinatesFrom4326([e[0]])),t.length?new A.Z(t):null})),ft(this,"modifyFeatures",(e=>{var t,o,r,i;let{currentFeature:s,features:n}=e.measurement||{},a=(null===(t=n[s])||void 0===t||null===(o=t.geometry)||void 0===o?void 0:o.coordinates)||[],l=(null===(r=n[s])||void 0===r||null===(i=r.geometry)||void 0===i?void 0:i.type)||"";var p;"Polygon"===l&&(a=(null===(p=a)||void 0===p?void 0:p[0])||[]);const h=a.length,c=a.some((e=>!(0,De.wd)(e)));let u;if(!c&&"LineString"===l&&h<2){const e=this.reprojectedCoordinatesFrom4326(a);u=new A.Z(e),n[s]=(0,Re.t8)("properties.disabled",!0,(0,Re.t8)("geometry.coordinates",[...a,["",""]],n[s]))}else!c&&"Polygon"===l&&h<=4&&$()(a[h-1],a[h-2])&&(a.splice(2,0,["",""]),a.pop(),n[s]=(0,Re.t8)("properties.disabled",!0,(0,Re.t8)("geometry.coordinates",[a],n[s])));var d,m,g,y;let f;return"Polygon"===l&&h<=4&&(u=this.convertPolyToLineFeature(a)),!c&&$()(a[h-1],a[h-2])&&(null===(d=n[s])||void 0===d||null===(m=d.geometry)||void 0===m||null===(g=m.coordinates)||void 0===g||null===(y=g[0])||void 0===y||y.pop()),u&&(this.source.clear(),f=new We.Z({geometry:u})),[n,f]})),ft(this,"updateFeatures",(e=>{const[t,o]=this.modifyFeatures(e)||[],r=this.source.getFeatures();this.removeMeasureTooltips(),this.removeSegmentLengthOverlays(),this.source.clear(),this.textLabels=[],this.segmentLengths=[];let i=null;this.updateInteraction(e,t);const s=t.map(((t,s)=>{if(ke()(t,"properties.disabled"))return i=s,[t,r&&r[s]&&r[s].getGeometry()||(null==o?void 0:o.getGeometry())];const n=t.geometry.type,a=ke()(t,"properties.values",[]),l="bearing"===(a[0]||{}).type||!(a[0]||{}).type&&e.measurement.bearingMeasureEnabled,p="Polygon"===n?t.geometry.coordinates[0]:t.geometry.coordinates;let h=p;"LineString"===n&&p.length>=2&&!l&&(h=(0,L.transformLineToArcs)(p));const c=this.reprojectedCoordinatesFrom4326(h),u="Polygon"===n?new q.ZP([c]):new A.Z(c),d={Point:()=>p,LineString:()=>l?(0,L.calculateAzimuth)(p[0],p[1],"EPSG:4326"):(0,L.calculateDistance)(p,e.measurement.lengthFormula),Polygon:()=>this.getArea(u)},m={LineString:()=>this.formatLengthValue(l?(0,L.calculateAzimuth)(p[0],p[1],"EPSG:4326"):(0,L.calculateDistance)(p,e.measurement.lengthFormula),e.uom,l,e.measurement.trueBearing),Polygon:()=>this.formatAreaValue(this.getArea(u),e.uom)},g=this.reprojectedCoordinatesFrom4326(p);if(!l)for(let t=0;t<p.length-1;++t){this.createSegmentLengthOverlay();const o=(0,L.calculateAzimuth)(p[t],p[t+1],"EPSG:4326"),r=(0,L.calculateDistance)([p[t],p[t+1]],e.measurement.lengthFormula),i=this.props.measurement&&this.props.measurement.showLengthAndBearingLabel&&" | "+(0,De.rp)(o,this.props.measurement.trueBearing)||"",s=this.formatLengthValue(r,e.uom,l)+i;Ae()(this.segmentOverlayElements).innerHTML=s;let a=(0,L.midpoint)(p[t],p[t+1],!0),c=(0,L.midpoint)(g[t],g[t+1],!0);if("LineString"===n){const e=h[100*t+50];e&&(a=e,c=(0,L.pointObjectToArray)((0,L.reproject)(e,"EPSG:4326",vt(this.props.map))))}Ae()(this.segmentOverlays).setPosition(c),this.textLabels[this.segmentOverlays.length-1]={text:s,position:a},this.segmentLengths[this.segmentOverlays.length-1]={value:r,type:l?"bearing":"length"}}if(this.createMeasureTooltip(),"Polygon"===n&&this.createMeasureTooltip(),this.tooltipCoord="LineString"===n?Ae()(g):this.tooltipCoord=u.getInteriorPoint().getCoordinates(),Ae()(this.measureTooltipElements).innerHTML=m[n](),Ae()(this.measureTooltips).setPosition(this.tooltipCoord),this.outputValues[this.measureTooltipElements.length-1]={value:d[n](),type:"Polygon"===n?"area":l?"bearing":"length"},"Polygon"===n){const t=(0,L.calculateDistance)(p,e.measurement.lengthFormula);this.measureTooltipElements[this.measureTooltipElements.length-2].innerHTML=this.formatLengthValue(t,e.uom,!1),this.outputValues[this.measureTooltipElements.length-2]={value:t,type:"length"},this.perimeterTooltipCoord=Ae()(g),this.measureTooltips[this.measureTooltipElements.length-2].setPosition(this.perimeterTooltipCoord),this.measureTooltips[this.measureTooltipElements.length-2].setOffset([0,-7])}let y={...t};return y.properties=t.properties?{...t.properties}:{},y.properties.values=[{value:(d[n]||(()=>null))(),formattedValue:(m[n]||(()=>null))(),position:"Polygon"===n?(0,L.pointObjectToArray)((0,L.reproject)(u.getInteriorPoint().getCoordinates(),vt(e.map),"EPSG:4326")):Ae()(p),type:(a[0]||{}).type||(e.measurement.pointMeasureEnabled?"point":e.measurement.lineMeasureEnabled?"length":e.measurement.areaMeasureEnabled?"area":e.measurement.bearingMeasureEnabled?"bearing":void 0)},..."Polygon"===n?[{value:(0,L.calculateDistance)(p,e.measurement.lengthFormula),formattedValue:this.formatLengthValue((0,L.calculateDistance)(p,e.measurement.lengthFormula),e.uom,!1),position:Ae()(p),uom:e.uom,type:"length"}]:[]],[y,u]})),n=s.map((e=>e[0])),a=s.map((e=>e[1]));this.source.addFeatures(a.filter((e=>!!e)).map((e=>new We.Z({geometry:e}))));let l=[...this.textLabels];n.map(((e,t)=>{var o,r;const s=!(null===(o=e.properties)||void 0===o||null===(r=o.values)||void 0===r||!r.find((e=>"bearing"===e.type))),n="Polygon"===e.geometry.type,a=n||s?0:1,p=n?e.geometry.coordinates[0]:e.geometry.coordinates,h=p.some((e=>!(0,De.wd)(e))),c=n?p.length-1:s?0:p.length;return e.geometry.textLabels=null!==i&&i===t&&h?e.geometry.textLabels.concat([{text:"0"}]):l.splice(0,c-a)||[],e})),this.props.changeGeometry(n),this.props.setTextLabels([...this.textLabels]);for(let e=0;e<this.measureTooltipElements.length;++e)this.measureTooltipElements[e]&&(this.measureTooltipElements[e].className="tooltip tooltip-static");for(let e=0;e<this.segmentOverlayElements.length;++e)this.segmentOverlayElements[e]&&(this.segmentOverlayElements[e].className="segment-overlay segment-overlay-static")})),ft(this,"updateMeasures",(e=>{const t=({type:t,value:o})=>"length"===t?this.formatLengthValue(o,e.uom,!1):"area"===t?this.formatAreaValue(o,e.uom):this.formatLengthValue(o,e.uom,!0,e.measurement.trueBearing);this.outputValues=this.outputValues||[],this.segmentOverlayElements=this.segmentOverlayElements||[],this.textLabels=this.textLabels||[];for(let e=0;e<this.outputValues.length;++e)this.outputValues[e]&&(this.measureTooltipElements[e].innerHTML=t(this.outputValues[e]));for(let e=0;e<this.segmentOverlayElements.length;++e){if(!this.segmentOverlayElements[e])continue;const o=t(this.segmentLengths[e]);let r=this.textLabels[e].text;const i=r.indexOf(" | ");r=r.replace(r.substring(0,-1!==i?i:r.length),o),this.segmentOverlayElements[e].innerHTML=r,this.textLabels[e].text=r}this.drawing||this.props.setTextLabels([...this.textLabels]);const o=(e.measurement.features||[]).map((e=>({...e,...e.properties?{properties:{...e.properties,values:(e.properties.values||[]).map((e=>({...e,formattedValue:t({type:e.type,value:e.value})})))}}:{}})));this.props.changeGeometry(o)})),ft(this,"addFeature",(e=>{let t=!1;this.source||(this.source=new Be.Z,t=!0);let o=(0,L.reprojectGeoJson)(e,"EPSG:4326",vt(this.props.map)).geometry;const r=new We.Z({geometry:Y(o)});this.source.addFeature(r),t&&this.measureLayer.setSource(this.source)})),ft(this,"resetGeometry",(()=>{this.source.clear(),this.props.resetGeometry()})),ft(this,"saveDrawState",(()=>{var e,t;this.savedDrawState={textLabels:this.textLabels.slice(),segmentLengths:this.segmentLengths.slice(),measureTooltipsLength:(null===(e=this.measureTooltips)||void 0===e?void 0:e.length)??0,segmentOverlaysLength:(null===(t=this.segmentOverlays)||void 0===t?void 0:t.length)??0}})),ft(this,"discardDrawState",(()=>{this.savedDrawState=null})),ft(this,"restoreDrawState",(()=>{if(this.savedDrawState){this.textLabels=this.savedDrawState.textLabels,this.segmentLengths=this.savedDrawState.segmentLengths;for(let e=this.savedDrawState.measureTooltipsLength;e<this.measureTooltips.length;++e)this.props.map.removeOverlay(this.measureTooltips[e]),this.measureTooltipElements[e].parentNode.removeChild(this.measureTooltipElements[e]);for(let e=this.savedDrawState.segmentOverlaysLength;e<this.segmentOverlays.length;++e)this.props.map.removeOverlay(this.segmentOverlays[e]),this.segmentOverlayElements[e].parentNode.removeChild(this.segmentOverlayElements[e]);this.measureTooltips.splice(this.savedDrawState.measureTooltipsLength),this.measureTooltipElements.splice(this.savedDrawState.measureTooltipsLength),this.outputValues.splice(this.savedDrawState.measureTooltipsLength),this.segmentOverlays.splice(this.savedDrawState.segmentOverlaysLength),this.segmentOverlayElements.splice(this.savedDrawState.segmentOverlaysLength),this.curPolygonLength=void 0,this.curLineStringLength=void 0,this.savedDrawState=null}})),ft(this,"addDrawInteraction",(e=>{let t,o,{startEndPoint:r}=e.measurement;if(this.continueLineMsg=(0,Ve.S$)(this.context.messages,"measureSupport.continueLine"),this.continuePolygonMsg=(0,Ve.S$)(this.context.messages,"measureSupport.continuePolygon"),this.drawInteraction&&this.removeDrawInteraction(),!this.vector){this.source=new Be.Z;let t=[new He.default({fill:new qe.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new Ye.default({color:"#ffcc33",width:2}),image:new Xe.default({radius:7,fill:new qe.default({color:"#ffcc33"})})})],o=[],i=r||!0===r;if(i||void 0===r){let t=i?void 0===r?{}:r:e.startEndPoint;o=(0,Pe.rm)(t.startPointOptions,t.endPointOptions)}const s=[...t,...o];this.vector=new Ue.Z({source:this.source,zIndex:1e6,style:s}),this.props.map.addLayer(this.vector)}o="Bearing"===e.measurement.geomType?"LineString":e.measurement.geomType,t=new mt({source:new Be.Z,type:o,style:new He.default({fill:new qe.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new Ye.default({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new Xe.default({radius:5,stroke:new Ye.default({color:"rgba(0, 0, 0, 0.7)"}),fill:new qe.default({color:"rgba(255, 255, 255, 0.2)"})})})}),this.clickListener=this.props.map.on("click",(()=>this.updateMeasurementResults(this.props))),this.props.updateOnMouseMove&&this.props.map.on("pointermove",(()=>this.updateMeasurementResults(this.props))),this.props.map.on("pointermove",(e=>this.pointerMoveHandler(e))),t.on("drawstart",(e=>{var t,o;this.sketchFeature=e.feature,this.drawing=!0,this.textId=(null===(t=this.props.measurement)||void 0===t||null===(o=t.features)||void 0===o?void 0:o.length)||0,this.textLabels||(this.textLabels=[]),this.segmentLengths||(this.segmentLengths=[]),this.props.measurement.disableLabels||(this.saveDrawState(),this.createMeasureTooltip("Polygon"===this.props.measurement.geomType?[0,0]:void 0),"Polygon"===this.props.measurement.geomType&&this.createMeasureTooltip(),"Polygon"===this.props.measurement.geomType&&this.createSegmentLengthOverlay()),this.listener=this.sketchFeature.getGeometry().on("change",(e=>{let t,o,r=e.target;if(r instanceof q.ZP){o={value:this.getArea(r),type:"area"},t=this.formatAreaValue(o.value,this.props.uom),this.tooltipCoord=r.getInteriorPoint().getCoordinates();const e=r.getCoordinates()[0];let i=[];if(!this.props.measurement.disableLabels&&((void 0===this.curPolygonLength||this.curPolygonLength<e.length)&&(this.createSegmentLengthOverlay(),this.curPolygonLength=e.length),e.length>2)){i.push((0,L.midpoint)(e[e.length-1],e[e.length-2],!0)),i.push((0,L.midpoint)(e[e.length-2],e[e.length-3],!0));for(let t=0;t<i.length;++t){const o=e.slice(e.length-2-t,e.length-t),r=this.getLength(o,this.props),s=this.props.measurement&&this.props.measurement.showLengthAndBearingLabel&&" | "+(0,De.rp)((0,L.calculateAzimuth)(o[0],o[1],vt(this.props.map)),this.props.measurement.trueBearing)||"",n=this.formatLengthValue(r,this.props.uom,!1)+s;this.segmentOverlayElements[this.segmentOverlays.length-t-1].innerHTML=n,this.segmentOverlays[this.segmentOverlays.length-t-1].setPosition(i[t]),this.segmentLengths[this.segmentOverlays.length-t-1]={value:r,type:"length"},this.textLabels[this.segmentOverlays.length-t-1]={text:n,position:(0,L.pointObjectToArray)((0,L.reproject)(i[t],vt(this.props.map),"EPSG:4326")),type:this.props.measurement.geomType,textId:this.textId}}}}else if(r instanceof A.Z){const e=r.getCoordinates(),i=[e[e.length-2],e[e.length-1]];this.props.measurement.disableLabels||this.props.measurement.bearingMeasureEnabled||!(void 0===this.curLineStringLength||this.curLineStringLength<e.length)||(this.createSegmentLengthOverlay(),this.curLineStringLength=e.length);const s=this.getLength(e,this.props),n=this.getLength(i,this.props);if(t=this.formatLengthValue(s,this.props.uom,"Bearing"===this.props.measurement.geomType,this.props.measurement.trueBearing),this.tooltipCoord=r.getLastCoordinate(),!this.props.measurement.disableLabels&&!this.props.measurement.bearingMeasureEnabled){const e=this.props.measurement&&this.props.measurement.showLengthAndBearingLabel&&" | "+(0,De.rp)((0,L.calculateAzimuth)(i[0],i[1],vt(this.props.map)),this.props.measurement.trueBearing)||"",t=this.formatLengthValue(n,this.props.uom,"Bearing"===this.props.measurement.geomType,this.props.measurement.trueBearing)+e;Ae()(this.segmentOverlayElements).innerHTML=t,Ae()(this.segmentOverlays).setPosition((0,L.midpoint)(i[0],i[1],!0)),this.textLabels[this.segmentOverlays.length-1]={text:t,position:(0,L.pointObjectToArray)((0,L.reproject)((0,L.midpoint)(i[0],i[1],!0),vt(this.props.map),"EPSG:4326")),type:this.props.measurement.geomType,textId:this.textId},this.segmentLengths[this.segmentOverlays.length-1]={value:n,type:"Bearing"===this.props.measurement.geomType?"bearing":"length"}}o={value:s,type:"Bearing"===this.props.measurement.geomType?"bearing":"length"}}if(!this.props.measurement.disableLabels&&(Ae()(this.measureTooltipElements).innerHTML=t,Ae()(this.measureTooltips).setPosition(this.tooltipCoord),this.outputValues[this.outputValues.length-1]=o,r instanceof q.ZP)){const e=r.getCoordinates()[0],t=this.getLength(3===e.length?Ze()(e):e,this.props);this.measureTooltipElements[this.measureTooltipElements.length-2].innerHTML=this.formatLengthValue(t,this.props.uom,!1),this.outputValues[this.measureTooltipElements.length-2]={value:t,type:"length"},this.perimeterTooltipCoord=r.getLastCoordinate(),this.measureTooltips[this.measureTooltipElements.length-2].setPosition(this.perimeterTooltipCoord)}}))})),t.on("drawend",(e=>{var t;this.drawing=!1;const o=ke()(this.props.measurement,"features",[]),r=e.feature.getGeometry(),i=r.getCoordinates(),s=new Te.Z,n={Point:()=>(0,L.reproject)(i,vt(this.props.map),"EPSG:4326"),LineString:()=>this.getLength(i,this.props),Polygon:()=>this.getArea(r),Bearing:()=>(0,L.calculateAzimuth)(i[0],i[1],vt(this.props.map))},a={LineString:()=>this.formatLengthValue(this.getLength(i,this.props),this.props.uom,!1),Polygon:()=>this.formatAreaValue(this.getArea(r),this.props.uom),Bearing:()=>this.formatLengthValue((0,L.calculateAzimuth)(i[0],i[1],vt(this.props.map)),this.props.uom,!0,this.props.measurement.trueBearing)};let l=(0,L.reprojectGeoJson)(s.writeFeatureObject(e.feature.clone()),vt(this.props.map),"EPSG:4326");l.properties=l.properties||{},l.properties.values=[{value:(n[this.props.measurement.geomType]||(()=>null))(),formattedValue:(a[this.props.measurement.geomType]||(()=>null))(),position:(0,L.pointObjectToArray)((0,L.reproject)("Polygon"===this.props.measurement.geomType?r.getInteriorPoint().getCoordinates():Ae()(i),vt(this.props.map),"EPSG:4326")),type:this.props.measurement.pointMeasureEnabled?"point":this.props.measurement.lineMeasureEnabled?"length":this.props.measurement.areaMeasureEnabled?"area":this.props.measurement.bearingMeasureEnabled?"bearing":void 0},..."Polygon"===this.props.measurement.geomType?[{value:(this.outputValues[this.measureTooltipElements.length-2]||{}).value||0,formattedValue:this.formatLengthValue((this.outputValues[this.measureTooltipElements.length-2]||{}).value||0,this.props.uom,!1),position:(0,L.pointObjectToArray)((0,L.reproject)(Ae()(i[0]),vt(this.props.map),"EPSG:4326")),uom:this.props.uom,type:"length"}]:[]];let p={...l};if(this.props.measurement.lineMeasureEnabled){let e=p.geometry.coordinates,t=(0,L.transformLineToArcs)(e);if(!this.props.measurement.disableLabels){this.removeLastSegment();for(let o=0;o<e.length-1;++o){const r=t[100*o+50];r&&(this.textLabels[this.segmentOverlays.length-e.length+1+o].position=r,this.segmentOverlays[this.segmentOverlays.length-e.length+1+o].setPosition((0,L.pointObjectToArray)((0,L.reproject)(r,"EPSG:4326",vt(this.props.map)))))}}p=(0,Re.t8)("geometry.coordinates",t,p)}else!this.props.measurement.disableLabels&&this.props.measurement.areaMeasureEnabled&&(this.textLabels.splice(this.segmentOverlays.length-2,1),this.props.map.removeOverlay(this.segmentOverlays[this.segmentOverlays.length-2]),this.segmentOverlayElements[this.segmentOverlays.length-2].parentNode.removeChild(this.segmentOverlayElements[this.segmentOverlays.length-2]),this.segmentOverlayElements.splice(this.segmentOverlays.length-2,1),this.segmentOverlays.splice(this.segmentOverlays.length-2,1));const h="bearing"===(null===(t=l.properties.values[0])||void 0===t?void 0:t.type)?"Bearing":l.geometry.type;if(l.geometry.textLabels=this.textLabels.filter((e=>e.type===h&&e.textId===this.textId)).map((({textId:e,type:t,...o})=>o)),this.props.changeGeometry([...o,l]),this.props.setTextLabels([...this.textLabels]),this.addFeature(p),!this.props.measurement.disableLabels&&(Ae()(this.measureTooltipElements).className="tooltip tooltip-static",Ae()(this.measureTooltips).setOffset([0,-7]),"Polygon"===this.props.measurement.geomType&&(this.measureTooltipElements[this.measureTooltipElements.length-2].className="tooltip tooltip-static",this.measureTooltips[this.measureTooltipElements.length-2].setOffset([0,-7])),this.segmentOverlayElements))for(let e=0;e<this.segmentOverlayElements.length;++e)this.segmentOverlayElements[e]&&(this.segmentOverlayElements[e].className="segment-overlay segment-overlay-static");(0,gt.B)(this.listener),this.curPolygonLength=void 0,this.curLineStringLength=void 0,this.discardDrawState()})),this.props.map.addInteraction(t),this.createHelpTooltip(),this.drawInteraction=t,this.measureLayer=this.vector})),ft(this,"removeLastSegment",(()=>{this.textLabels.pop(),this.segmentLengths.pop(),this.props.map.removeOverlay(Ae()(this.segmentOverlays)),Ae()(this.segmentOverlayElements).parentNode.removeChild(Ae()(this.segmentOverlayElements)),this.segmentOverlays.pop(),this.segmentOverlayElements.pop()})),ft(this,"removeDrawInteraction",(()=>{null!==this.drawInteraction&&(this.removeHelpTooltip(),this.props.map.removeInteraction(this.drawInteraction),this.drawInteraction=null,this.sketchFeature=null,this.props.map.un("click",(()=>this.updateMeasurementResults(this.props)),this),(0,gt.B)(this.clickListener),this.props.updateOnMouseMove&&this.props.map.un("pointermove",(()=>this.updateMeasurementResults(this.props)),this))})),ft(this,"pointerMoveHandler",(function(e){if(e.dragging)return;let t=(0,Ve.S$)(this.context.messages,"measureSupport.startDrawing");if(this.sketchFeature&&this.drawing){let e=this.sketchFeature.getGeometry();e instanceof q.ZP?t=this.continuePolygonMsg:e instanceof A.Z&&(t=this.continueLineMsg)}this.helpTooltipElement.innerHTML=t,this.helpTooltip.setPosition(e.coordinate),this.helpTooltipElement.classList.remove("hidden")})),ft(this,"updateMeasurementResults",(e=>{if(!this.sketchFeature)return;let t=this.sketchFeature.getGeometry().getCoordinates();if("Bearing"===e.measurement.geomType&&t.length>1&&t.length>2){for(this.drawInteraction.sketchCoords_=[t[0],t[1],t[0]];this.sketchFeature.getGeometry().getCoordinates().length>3;)this.drawInteraction.removeLastPoint();this.sketchFeature.getGeometry().setCoordinates([t[0],t[1]]),this.drawInteraction.sketchFeature_=this.sketchFeature,this.drawInteraction.finishDrawing()}})),ft(this,"reprojectedCoordinatesFrom4326",(e=>e.map((e=>{let t=(0,L.reproject)(e,"EPSG:4326",vt(this.props.map));return[t.x,t.y]})))),ft(this,"reprojectedCoordinatesIn4326",(e=>e.map((e=>{let t=(0,L.reproject)(e,vt(this.props.map),"EPSG:4326");return[t.x,t.y]})))),ft(this,"calculateGeodesicArea",(e=>{if(e.length>=4){const t=this.reprojectedCoordinatesIn4326(e);return Math.abs((0,yt.bg)(new q.ZP([t]),{projection:"EPSG:4326"}))}return 0})),ft(this,"createHelpTooltip",(()=>{this.removeHelpTooltip(),this.helpTooltipElement=document.createElement("div"),this.helpTooltipElement.className="tooltip hidden",this.helpTooltip=new ze.Z({element:this.helpTooltipElement,offset:[15,0],positioning:"center-left"}),this.props.map.addOverlay(this.helpTooltip)})),ft(this,"createMeasureTooltip",((e=[0,-15])=>{this.measureTooltipElements||(this.measureTooltipElements=[]),this.measureTooltips||(this.measureTooltips=[]),this.outputValues||(this.outputValues=[]);let t=document.createElement("div");t.className="tooltip tooltip-measure",t.style.display=this.props.measurement.showLabel?"":"none",this.measureTooltipElements.push(t);let o=new ze.Z({element:t,offset:e,positioning:"bottom-center"});this.props.map.addOverlay(o),this.measureTooltips.push(o),this.outputValues.push(null)})),ft(this,"createSegmentLengthOverlay",(e=>{this.segmentOverlayElements||(this.segmentOverlayElements=[]),this.segmentOverlays||(this.segmentOverlays=[]);let t=document.createElement("div");t.className="segment-overlay",t.style.display=this.props.measurement.showSegmentLengths&&!e?"":"none",this.segmentOverlayElements.push(t);let o=new ze.Z({element:t,offset:[0,0],positioning:"center-center"});this.props.map.addOverlay(o),this.segmentOverlays.push(o)})),ft(this,"formatLengthValue",((e,t,o,r={})=>{if(o)return(0,De.rp)(e,r);const{label:i,unit:s}=t&&t.length,n=Me()((0,De.Ov)(e,"m",s),2);return this.props.formatNumber(n)+" "+i})),ft(this,"formatAreaValue",((e,t)=>{const{label:o,unit:r}=t&&t.area,i=Me()((0,De.Ov)(e,"sqm",r),2);return this.props.formatNumber(i)+" "+o})),ft(this,"removeHelpTooltip",(()=>{this.helpTooltipElement&&this.helpTooltipElement.parentNode&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltip&&this.props.map.removeOverlay(this.helpTooltip)})),ft(this,"removeMeasureTooltips",(()=>{(this.measureTooltips||[]).forEach((e=>{this.props.map.removeOverlay(e)}));let e=document.getElementsByClassName("tooltip-static")||[];for(let t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t]);e=document.getElementsByClassName("tooltip-measure")||[];for(let t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t]);this.measureTooltips=[],this.measureTooltipElements=[],this.outputValues=[]})),ft(this,"removeSegmentLengthOverlays",(()=>{(this.segmentOverlays||[]).forEach((e=>{this.props.map.removeOverlay(e)})),(this.segmentOverlayElements||[]).forEach((e=>{e.parentNode.removeChild(e)})),this.segmentOverlays=[],this.segmentOverlayElements=[]}))}UNSAFE_componentWillReceiveProps(e){if(this.measureTooltipElements&&e.measurement.showLabel!==this.props.measurement.showLabel)for(let t=0;t<this.measureTooltipElements.length;++t)this.measureTooltipElements[t]&&(this.measureTooltipElements[t].style.display=e.measurement.showLabel?"":"none");if(this.segmentOverlayElements&&e.measurement.showSegmentLengths)for(let t=0;t<this.segmentOverlayElements.length;++t)this.segmentOverlayElements[t]&&(this.segmentOverlayElements[t].style.display=e.measurement.showSegmentLengths?"":"none");(e.measurement.geomType&&e.measurement.geomType!==this.props.measurement.geomType||e.measurement.geomType&&(e.measurement.lineMeasureEnabled||e.measurement.areaMeasureEnabled||e.measurement.bearingMeasureEnabled)&&!this.props.enabled&&e.enabled)&&(this.restoreDrawState(),this.addDrawInteraction(e)),e.measurement.geomType||(this.removeDrawInteraction(),this.removeMeasureTooltips(),this.removeSegmentLengthOverlays(),this.textLabels=[],this.segmentLengths=[],this.props.map.removeLayer(this.measureLayer),this.vector=null,this.measureLayer=null,e.measurement.features&&e.measurement.features.length>0&&this.props.changeGeometry([]),e.measurement.textLabels&&e.measurement.textLabels.length>0&&this.props.setTextLabels([]),this.source&&(this.source.clear(),this.source=null));let t=this.props.measurement.features,o=e.measurement.features;e.measurement.updatedByUI&&!$()(t,o)?this.updateFeatures(e):e.measurement.updatedByUI&&!$()(this.props.uom,e.uom)&&this.updateMeasures(e)}render(){return null}}ft(_t,"propTypes",{startEndPoint:s().object,map:s().object,measurement:s().object,enabled:s().bool,uom:s().object,formatNumber:s().func,changeMeasurementState:s().func,updateMeasures:s().func,resetGeometry:s().func,changeGeometry:s().func,updateOnMouseMove:s().bool,setTextLabels:s().func}),ft(_t,"contextTypes",{messages:s().object}),ft(_t,"defaultProps",{changeMeasurementState:()=>{},resetGeometry:()=>{},updateMeasures:()=>{},changeGeometry:()=>{},formatNumber:e=>e,setTextLabels:()=>{},startEndPoint:{startPointOptions:{radius:3,fillColor:"green",applyToPolygon:!0},endPointOptions:{radius:3,fillColor:"red",applyToPolygon:!0}},updateOnMouseMove:!1});var wt=o(97398),bt=o.n(wt),Ct=o(78426),xt=o(40188),St=o(39850),Pt=o(13910),Et=o(12868),Lt=o(86340),Tt=o(19530),Ft=o(67644),Ot=o(85386);function It(e){this.validateExtent_(),this.updateBox_()}const Mt=function(e){function t(t){var o=t||{};e.call(this,{element:document.createElement("div"),render:o.render||It,target:o.target}),this.collapsed_=void 0===o.collapsed||o.collapsed,this.collapsible_=void 0===o.collapsible||o.collapsible,this.collapsible_||(this.collapsed_=!1);var r=void 0!==o.className?o.className:"ol-overviewmap",i=void 0!==o.tipLabel?o.tipLabel:"Overview map",s=void 0!==o.collapseLabel?o.collapseLabel:"«";"string"==typeof s?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s):this.collapseLabel_=s;var n=void 0!==o.label?o.label:"»";"string"==typeof n?(this.label_=document.createElement("span"),this.label_.textContent=n):this.label_=n;var a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,l=document.createElement("button");l.setAttribute("type","button"),l.title=i,l.appendChild(a),(0,tt.oL)(l,Ke.Z.CLICK,this.handleClick_,this),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.ovmap_=new m.default({controls:new Ct.Z,interactions:new Ct.Z,view:o.view});var p=this.ovmap_;o.layers&&o.layers.forEach(function(e){p.addLayer(e)}.bind(this));var h=document.createElement("div");h.className="ol-overviewmap-box",h.style.boxSizing="border-box",this.boxOverlay_=new ze.Z({position:[0,0],positioning:Et.Z.BOTTOM_LEFT,element:h}),this.ovmap_.addOverlay(this.boxOverlay_);var c=r+" "+Ft.XV+" "+Ft.hg+(this.collapsed_&&this.collapsible_?" "+Ft.hN:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=c,u.appendChild(this.ovmapDiv_),u.appendChild(l);var d=this,g=this.boxOverlay_,y=this.boxOverlay_.getElement(),f=function(e){var t,o={clientX:(t=e).clientX-y.offsetWidth/2,clientY:t.clientY+y.offsetHeight/2},r=p.getEventCoordinate(o);g.setPosition(r)},v=function(e){var t=p.getEventCoordinate(e);d.getMap().getView().setCenter(t),window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",v)};y.addEventListener("mousedown",(function(){window.addEventListener("mousemove",f),window.addEventListener("mouseup",v)}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setMap=function(t){var o=this.getMap();if(t!==o){if(o){var r=o.getView();r&&this.unbindView_(r),this.ovmap_.setTarget(null)}if(e.prototype.setMap.call(this,t),t){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push((0,tt.oL)(t,Pt.Z.PROPERTYCHANGE,this.handleMapPropertyChange_,this)),0===this.ovmap_.getLayers().getLength()&&this.ovmap_.setLayerGroup(t.getLayerGroup());var i=t.getView();i&&(this.bindView_(i),i.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_()))}}},t.prototype.handleMapPropertyChange_=function(e){if(e.key===St.Z.VIEW){var t=e.oldValue;t&&this.unbindView_(t);var o=this.getMap().getView();this.bindView_(o)}},t.prototype.bindView_=function(e){(0,tt.oL)(e,(0,Qe.v_)(Lt.Z.ROTATION),this.handleRotationChanged_,this)},t.prototype.unbindView_=function(e){(0,tt.Ev)(e,(0,Qe.v_)(Lt.Z.ROTATION),this.handleRotationChanged_,this)},t.prototype.handleRotationChanged_=function(){this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())},t.prototype.validateExtent_=function(){var e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){var o=e.getSize(),r=e.getView().calculateExtent(o),i=t.getSize(),s=t.getView().calculateExtent(i),n=t.getPixelFromCoordinate((0,_.rL)(r)),a=t.getPixelFromCoordinate((0,_.w$)(r)),l=Math.abs(n[0]-a[0]),p=Math.abs(n[1]-a[1]),h=i[0],c=i[1];l<.1*h||p<.1*c||l>.75*h||p>.75*c?this.resetExtent_():(0,_.r4)(s,r)||this.recenter_()}},t.prototype.resetExtent_=function(){var e=this.getMap(),t=this.ovmap_,o=e.getSize(),r=e.getView().calculateExtent(o),i=t.getView(),s=Math.log(7.5)/Math.LN2,n=1/(.1*Math.pow(2,s/2));(0,_.H9)(r,n),i.fit(r)},t.prototype.recenter_=function(){var e=this.getMap(),t=this.ovmap_,o=e.getView();t.getView().setCenter(o.getCenter())},t.prototype.updateBox_=function(){var e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){var o=e.getSize(),r=e.getView(),i=t.getView(),s=r.getRotation(),n=this.boxOverlay_,a=this.boxOverlay_.getElement(),l=r.calculateExtent(o),p=i.getResolution(),h=(0,_.hC)(l),c=(0,_.Xv)(l),u=this.calculateCoordinateRotate_(s,h);n.setPosition(u),a&&(a.style.width=Math.abs((h[0]-c[0])/p)+"px",a.style.height=Math.abs((c[1]-h[1])/p)+"px")}},t.prototype.calculateCoordinateRotate_=function(e,t){var o,r=this.getMap().getView().getCenter();return r&&(o=[t[0]-r[0],t[1]-r[1]],(0,et.U1)(o,e),(0,et.IH)(o,r)),o},t.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_()},t.prototype.handleToggle_=function(){this.element.classList.toggle(Ft.hN),this.collapsed_?(0,Ot.$H)(this.collapseLabel_,this.label_):(0,Ot.$H)(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;var e=this.ovmap_;this.collapsed_||e.isRendered()||(e.updateSize(),this.resetExtent_(),(0,tt.Vx)(e,xt.Z.POSTRENDER,(function(e){this.updateBox_()}),this))},t.prototype.getCollapsible=function(){return this.collapsible_},t.prototype.setCollapsible=function(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())},t.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()},t.prototype.getCollapsed=function(){return this.collapsed_},t.prototype.getOverviewMap=function(){return this.ovmap_},t}(Tt.Z);function Gt(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}o(55691);const kt={className:"ol-overviewmap ol-custom-overviewmap",collapseLabel:"»",label:"«",collapsed:!0,collapsible:!0};class jt extends S().Component{constructor(...e){super(...e),Gt(this,"dragstart",(e=>{this.dragging||(this.dragBox=this.box.cloneNode(),this.dragBox.setAttribute("class","ol-overview-dargbox"),this.dragBox.style.position="relative",this.box.appendChild(this.dragBox),""===this.box.style.top?this.offsetStartTop=0:this.offsetStartTop=parseInt(this.box.style.top.slice(0,-2),10),""===this.box.style.left?this.offsetStartLeft=0:this.offsetStartLeft=parseInt(this.box.style.left.slice(0,-2),10),this.mouseStartTop=e.pageY,this.mouseStartLeft=e.pageX,this.dragging=!0)})),Gt(this,"draggingel",(e=>{!0===this.dragging&&(this.dragBox.style.top=this.offsetStartTop+e.pageY-this.mouseStartTop+"px",this.dragBox.style.left=this.offsetStartLeft+e.pageX-this.mouseStartLeft+"px",e.stopPropagation(),e.preventDefault())})),Gt(this,"dragend",(()=>{if(!0===this.dragging){let e={};e.top=""===this.dragBox.style.top?0:parseInt(this.dragBox.style.top.slice(0,-2),10),e.left=""===this.dragBox.style.left?0:parseInt(this.dragBox.style.left.slice(0,-2),10),this.box.removeChild(this.dragBox),delete this.dragBox,this.dragging=!1,this.setNewExtent(e)}})),Gt(this,"setNewExtent",(e=>{let t=this.box.offsetWidth,o=this.box.offsetHeight,r=this.props.map.getSize(),i=e.left*Math.abs(r[0]/t),s=e.top*Math.abs(r[1]/o);i=bt()(i)?i:0,s=bt()(s)?s:0;let n=[0+i,r[1]+s],a=[r[0]+i,0+s],l=this.props.map.getCoordinateFromPixel(n)||[0,0],p=this.props.map.getCoordinateFromPixel(a)||[0,0],h=[l[0],l[1],p[0],p[1]];this.props.map.getView().fit(h,r,{nearest:!0})}))}componentDidMount(){let e=[];this.props.layers.forEach((t=>{e.push(de.default.createLayer(t.type,t.options||{}))}));let t=E()({},kt,this.props.overviewOpt,{layers:e});this.overview=new Mt(t),this.props.map&&this.overview.setMap(this.props.map),this.box=this.overview.element.getElementsByClassName("ol-overviewmap-box").item(0),this.box.onmousedown=e=>{this.dragstart(e),this.box.onmousemove=e=>{this.draggingel(e)},this.overview.element.onmousemove=e=>{this.draggingel(e)},this.box.onmouseup=()=>{this.dragend(),this.overview.element.onmousemove=null,this.box.onmousemove=null,this.box.onmouseup=null}}}render(){return null}}Gt(jt,"displayName","Overview"),Gt(jt,"propTypes",{id:s().string,map:s().object,overviewOpt:s().object,layers:s().array}),Gt(jt,"defaultProps",{id:"overview",overviewOpt:{},layers:[{type:"osm",options:{}}]});var Zt=o(38906),Nt="units",At="degrees",Dt="metric",Rt=[1,2,5];function Vt(e){var t=e.frameState;this.viewState_=t?t.viewState:null,this.updateElement_()}const zt=function(e){function t(t){var o=t||{},r=void 0!==o.className?o.className:"ol-scale-line";e.call(this,{element:document.createElement("div"),render:o.render||Vt,target:o.target}),this.innerElement_=document.createElement("div"),this.innerElement_.className=r+"-inner",this.element.className=r+" "+Ft.XV,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=void 0!==o.minWidth?o.minWidth:64,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",(0,tt.oL)(this,(0,Qe.v_)(Nt),this.handleUnitsChanged_,this),this.setUnits(o.units||Dt)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getUnits=function(){return this.get(Nt)},t.prototype.handleUnitsChanged_=function(){this.updateElement_()},t.prototype.setUnits=function(e){this.set(Nt,e)},t.prototype.updateElement_=function(){var e=this.viewState_;if(e){var t=e.center,o=e.projection,r=this.getUnits(),i=r==At?v.default.DEGREES:v.default.METERS,s=(0,y._Q)(o,e.resolution,t,i);o.getUnits()!=v.default.DEGREES&&o.getMetersPerUnit()&&i==v.default.METERS&&(s*=o.getMetersPerUnit());var n=this.minWidth_*s,a="";if(r==At){var l=v.METERS_PER_UNIT[v.default.DEGREES];o.getUnits()==v.default.DEGREES?n*=l:s/=l,n<l/60?(a="″",s*=3600):n<l?(a="′",s*=60):a="°"}else"imperial"==r?n<.9144?(a="in",s/=.0254):n<1609.344?(a="ft",s/=.3048):(a="mi",s/=1609.344):"nautical"==r?(s/=1852,a="nm"):r==Dt?n<.001?(a="μm",s*=1e6):n<1?(a="mm",s*=1e3):n<1e3?a="m":(a="km",s/=1e3):"us"==r?n<.9144?(a="in",s*=39.37):n<1609.344?(a="ft",s/=.30480061):(a="mi",s/=1609.3472):(0,Zt.h)(!1,33);for(var p,h,c=3*Math.floor(Math.log(this.minWidth_*s)/Math.log(10));;){if(p=Rt[(c%3+3)%3]*Math.pow(10,Math.floor(c/3)),h=Math.round(p/s),isNaN(h))return this.element.style.display="none",void(this.renderedVisible_=!1);if(h>=this.minWidth_)break;++c}var u=p+" "+a;this.renderedHTML_!=u&&(this.innerElement_.innerHTML=u,this.renderedHTML_=u),this.renderedWidth_!=h&&(this.innerElement_.style.width=h+"px",this.renderedWidth_=h),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},t}(Tt.Z);function Bt(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class Ut extends S().Component{componentDidMount(){this.scalebar=new zt(E()({},this.props,this.props.container?{target:document.querySelector(this.props.container)}:{})),this.props.map&&this.props.map.addControl(this.scalebar)}componentWillUnmount(){if(this.props.container&&document.querySelector(".ol-scale-line"))try{document.querySelector(this.props.container).removeChild(document.querySelector(".ol-scale-line"))}catch(e){}}render(){return null}}Bt(Ut,"propTypes",{map:s().object,className:s().string,minWidth:s().number,units:s().oneOf(["degrees","imperial","nautical","metric","us"]),container:s().string}),Bt(Ut,"defaultProps",{map:null,className:"ol-scale-line",minWidth:64,units:"metric"});var Wt=o(57043),Ht=o.n(Wt),qt=o(91175),Yt=o.n(qt),Xt=o(12571),Kt=o.n(Xt),$t=o(63105),Jt=o.n($t),Qt=o(55877),eo=o.n(Qt),to=o(23570),oo=o.n(to),ro=o(30749),io=o(52628),so=o.n(io),no=o(30998),ao=o.n(no),lo=o(47037),po=o.n(lo),ho=o(39153);var co=o(29346);const uo=function(e,t){if(t=t||{},!(0,co.Kn)(t))throw new Error("options is invalid");var o=t.properties;if(!e)throw new Error("geojson is required");var r=function(e){var t=[1/0,1/0,-1/0,-1/0];return(0,ho.pZ)(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}(e),i=(r[0]+r[2])/2,s=(r[1]+r[3])/2;return(0,co.xm)([i,s],o)};let mo={};const go={color:"#ffcc33",opacity:1,weight:3,fillColor:"#ffffff",fillOpacity:.2},yo={iconGlyph:"comment",iconShape:"square",iconColor:"blue"},fo={fontStyle:"normal",fontSize:"14",fontSizeUom:"px",fontFamily:"Arial",fontWeight:"normal",font:"14px Arial",textAlign:"center",color:"#000000",opacity:1,fillColor:"#000000",fillOpacity:1},vo={color:"#ffcc33",opacity:1,weight:3,editing:{fill:1}},_o={color:"#ffcc33",opacity:1,weight:3,fillColor:"#ffffff",fillOpacity:.2,editing:{fill:1}},wo={Text:fo,Point:yo,Circle:go,MultiPoint:yo,LineString:vo,MultiLineString:vo,Polygon:_o,MultiPolygon:_o},bo="ms2-annotations",Co=(e="")=>-1!==e.indexOf("rgba")?`rgb${e.slice(e.indexOf("("),e.lastIndexOf(","))})`:e,xo=e=>po()(e)&&e||re()(e)&&e.join(" "),So=(e,t,o="")=>{const r=t&&t[e]?t[e]:t,i=r.dashArray?xo(r.dashArray):"solid";switch(e){case"MultiPolygon":case"Polygon":case"Circle":return{strokeColor:Co(r.color),strokeOpacity:r.opacity,strokeWidth:r.weight,fillColor:Co(r.fillColor),fillOpacity:r.fillOpacity,strokeDashstyle:i};case"LineString":case"MultiLineString":return{strokeColor:Co(r.color),strokeOpacity:r.opacity,strokeWidth:r.weight,strokeDashstyle:i};case"Text":const e=(s=r).color&&s.opacity&&s.weight?{labelOutlineColor:Co(r.color),labelOutlineOpacity:r.opacity,labelOutlineWidth:r.weight}:{};return{fontStyle:r.fontStyle,fontSize:r.fontSize,fontFamily:r.fontFamily,fontWeight:r.fontWeight,labelAlign:(n=r.textAlign,("start"===n?"lm":"end"===n&&"rm")||"cm"),fontColor:Co(r.fillColor),fontOpacity:r.fillOpacity,label:o,stroke:!0,strokeColor:Co(r.color),strokeOpacity:r.opacity,strokeWidth:r.weight,strokeDashstyle:i,...e};case"Point":case"MultiPoint":{const e=r.symbolUrl&&(0,Le.fetchStyle)((0,Le.hashAndStringify)(r),"base64")||ro.Z.extraMarkers.markerToDataUrl(r);let t=-18,o=-46;return r.iconAnchor&&re()(r.iconAnchor)&&r.size&&(t="pixels"===r.anchorXUnits?-1*r.iconAnchor[0]:-1*r.size*r.iconAnchor[0],o="pixels"===r.anchorYUnits?-1*r.iconAnchor[1]:-1*r.size*r.iconAnchor[1]),e?{graphicWidth:r.size||36,graphicHeight:r.size||46,externalGraphic:e,graphicXOffset:t,graphicYOffset:o,display:!1===r.filtering&&"none"}:{fillColor:"#0000AE",fillOpacity:.5,strokeColor:"#0000FF",pointRadius:10,strokeOpacity:1,strokeWidth:1,display:!1===r.filtering&&"none"}}default:return{fillColor:"#FF0000",fillOpacity:0,strokeColor:"#FF0000",pointRadius:5,strokeOpacity:1,strokeDashstyle:i,strokeWidth:1}}var s,n},Po=(e=[[[]]])=>{const t=e[0].filter(mo.validateCoordsArray);return t.length>3&&Yt()(t)[0]===Ae()(t)[0]&&Yt()(t)[1]===Ae()(t)[1]};mo={ANNOTATION_TYPE:bo,convertGeoJSONToInternalModel:({type:e="Point",geometries:t=[],features:o=[]},r=[],i=[])=>{switch(e){case"Point":case"MultiPoint":return{type:1===r.length?"Text":e};case"Polygon":return{type:1===i.length?"Circle":e};case"GeometryCollection":{const e=t.filter((e=>"Point"===e.type||"MultiPoint"===e.type)),o=t.filter((e=>"Polygon"===e.type));let s=0,n=0;return{type:"GeometryCollection",geometries:t.map((t=>{if("Point"===t.type||"MultiPoint"===t.type){if(e.length===r.length)return{type:"Text"};if(0===r.length)return{type:t.type};if(0===s)return s++,{type:"Text"}}if("Polygon"===t.type){if(o.length===i.length)return{type:"Circle"};if(0===i.length)return{type:t.type};if(0===n)return n++,{type:"Circle"}}return{type:t.type}}))}}case"FeatureCollection":return{type:"FeatureCollection",features:o.map((e=>e.properties&&e.properties.isCircle?{type:"Circle"}:e.properties&&e.properties.isText?{type:"Text"}:{type:e.geometry.type}))};default:return{type:e}}},getAvailableStyler:({type:e="Point",geometries:t=[],features:o=[]}={})=>{switch(e){case"Point":case"MultiPoint":case"Symbol":return[mo.getRelativeStyler(e)];case"LineString":case"MultiLineString":return[mo.getRelativeStyler(e)];case"Polygon":case"MultiPolygon":case"Text":case"Circle":return[mo.getRelativeStyler(e)];case"GeometryCollection":return t.reduce(((e,t)=>-1!==e.indexOf(mo.getRelativeStyler(t.type))?e:e.concat(mo.getAvailableStyler(t))),[]);case"FeatureCollection":return o.reduce(((e,t)=>-1!==e.indexOf(mo.getRelativeStyler(t.type))?e:e.concat(mo.getAvailableStyler(t))),[]);default:return[]}},getRelativeStyler:e=>{switch(e){case"Point":case"MultiPoint":return"marker";case"Symbol":return"symbol";case"Circle":return"circle";case"LineString":case"MultiLineString":return"lineString";case"Polygon":case"MultiPolygon":return"polygon";case"Text":return"text";default:return""}},createFont:({fontSize:e="14",fontSizeUom:t="px",fontFamily:o="Arial",fontStyle:r="normal",fontWeight:i="normal"}={})=>`${r} ${i} ${e}${t} ${o}`,DEFAULT_ANNOTATIONS_STYLES:wo,STYLE_CIRCLE:go,STYLE_POINT_MARKER:yo,STYLE_POINT_SYMBOL:{iconAnchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction",color:"#000000",fillColor:"#000000",opacity:1,size:64,fillOpacity:1},STYLE_TEXT:fo,STYLE_LINE:vo,STYLE_POLYGON:_o,getGeometryType:e=>{var t,o,r;return null!=e&&null!==(t=e.properties)&&void 0!==t&&t.isCircle?"Circle":null!=e&&null!==(o=e.properties)&&void 0!==o&&o.isText?"Text":null==e||null===(r=e.geometry)||void 0===r?void 0:r.type},getGeometryGlyphInfo:(e="Point")=>({Point:{glyph:"point",label:"Point"},MultiPoint:{glyph:"point",label:"Point"},LineString:{glyph:"polyline",label:"Line"},MultiLineString:{glyph:"polyline",label:"Line"},Polygon:{glyph:"polygon",label:"Polygon"},MultiPolygon:{glyph:"polygon",label:"Polygon"},Text:{glyph:"font",label:"Text"},Circle:{glyph:"1-circle",label:"Circle"}}[e]),normalizeAnnotation:(e={},t={})=>{const o="FeatureCollection"===e.type?{...e}:{type:"Feature",geometry:e};return{style:(({type:e="Point",features:t=[]}={})=>"FeatureCollection"===e?t.reduce(((e,t)=>(e[t.geometry.type]=wo[t.geometry.type],e)),{type:"FeatureCollection"}):{...wo[e]})(o),properties:((e={},t={})=>({title:"annotations.defaulttitle"!==(0,Ve.S$)(t,"annotations.defaulttitle")?(0,Ve.S$)(t,"annotations.defaulttitle"):"Default title",id:oo()(),...e}))(o.properties,t),...o}},removeDuplicate:e=>so()(e.reduce(((e,t)=>({...e,[t.properties.id]:t})),{})),circlesToMultiPolygon:({geometries:e=[]},{circles:t=[]},o=go)=>({type:"Feature",geometry:{type:"MultiPolygon",coordinates:t.reduce(((t,o)=>t.concat([e[o].coordinates])),[])},properties:{id:oo()(),ms_style:So("Circle",o)}}),fromCircleToPolygon:(e,t,o=go)=>({type:"Feature",geometry:t.polygonGeom||e,properties:{id:t.id||oo()(),ms_style:So("Circle",o)}}),fromTextToPoint:(e,t,o=fo)=>({type:"Feature",geometry:e,properties:{id:t.id||oo()(),ms_style:So("Text",o,t.valueText)}}),fromLineStringToGeodesicLineString:(e,t=vo)=>({type:"Feature",geometry:e.geometryGeodesic,properties:{id:e.id||oo()(),ms_style:So(e.geometryGeodesic.type,t)}}),textToPoint:({geometries:e=[]},{textGeometriesIndexes:t=[],textValues:o=[]},r=fo)=>t.map(((t,i)=>({type:"Feature",geometry:e[t],properties:{id:oo()(),ms_style:So("Text",r,o[i])}}))),flattenGeometryCollection:({geometry:e,properties:t,style:o})=>{const r=t.circles&&mo.circlesToMultiPolygon(e,t,o.Circle)||[],i=t.textGeometriesIndexes&&mo.textToPoint(e,t,o.Text)||[],s=(t.circles||[]).concat(t.textGeometriesIndexes||[]);return e.geometries.filter(((e,t)=>-1===s.indexOf(t))).map((e=>({type:"Feature",geometry:e,properties:{id:oo()(),ms_style:So(e.type,o[e.type])}}))).concat(r,i)},createGeometryFromGeomFunction:e=>{let t=Le.geometryFunctions[e.style.geometry]&&Le.geometryFunctions[e.style.geometry].type||e.geometry.type,o=e.geometry.coordinates||[];switch(e.style.geometry){case"startPoint":o=Yt()(o);break;case"endPoint":o=Ae()(o);break;case"centerPoint":o=uo(e).geometry.coordinates}return{type:t,coordinates:o}},fromAnnotationToGeoJson:({geometry:e,properties:t={},style:o={}}={})=>{let r=o.geometry?mo.createGeometryFromGeomFunction({geometry:e,properties:t,style:o,type:"Feature"}):e;return t.isCircle&&"Polygon"===r.type?mo.fromCircleToPolygon(r,t,o):t.isText?mo.fromTextToPoint(r,t,o):"LineString"===r.type&&t.useGeodesicLines&&o.filtering?mo.fromLineStringToGeodesicLineString(t,o):{type:"Feature",geometry:r,properties:{id:t.id||oo()(),ms_style:So(r.type,o)}}},annotationsToPrint:(e=[])=>e.reduce(((e,t)=>"FeatureCollection"===t.type?e.concat(t.features.map((e=>Se()(e.style||t.style||{}).filter((e=>!!se()(e.filtering)||e.filtering)).map((t=>mo.fromAnnotationToGeoJson({...e,style:t}))))).reduce(((e,t)=>e.concat(t)),[])):t.geometry&&"GeometryCollection"===t.geometry.type?e.concat(mo.flattenGeometryCollection(t)):e.concat({type:"Feature",geometry:t.geometry,properties:{...t.properties,ms_style:So(t.geometry.type,t.style)}})),[]),formatCoordinates:(e=[[]])=>e.map((e=>({lat:e&&e[1],lon:e&&e[0]}))),getBaseCoord:e=>{switch(e){case"Polygon":case"LineString":case"MultiPoint":return[];default:return[[{lat:"",lon:""}]]}},getComponents:({type:e,coordinates:t})=>{switch(e){case"Polygon":return mo.isCompletePolygon(t)?mo.formatCoordinates(Kt()(t[0],0,t[0].length-1)):mo.formatCoordinates(t[0]);case"LineString":case"MultiPoint":return mo.formatCoordinates(t);default:return mo.formatCoordinates([t])}},addIds:e=>e.map((e=>e.properties&&e.properties.id?e:(0,Re.t8)("properties.id",eo().v1(),e))),COMPONENTS_VALIDATION:{Point:{min:1,add:!1,remove:!1,validation:"validateCoordinates",notValid:"Add a valid coordinate to complete the Point"},MultiPoint:{min:2,add:!0,remove:!0,validation:"validateCoordinates",notValid:"Add 2 valid coordinates to complete the Polyline"},Polygon:{min:3,add:!0,remove:!0,validation:"validateCoordinates",notValid:"Add 3 valid coordinates to complete the Polygon"},LineString:{min:2,add:!0,remove:!0,validation:"validateCoordinates",notValid:"Add 2 valid coordinates to complete the Polyline"},Circle:{add:!1,remove:!1,validation:"validateCircle",notValid:"Add a valid coordinate and a radius (m) to complete the Circle"},Text:{add:!1,remove:!1,validation:"validateText",notValid:"Add a valid coordinate and a Text value"}},validateCoords:({lat:e,lon:t}={})=>!isNaN(parseFloat(e))&&!isNaN(parseFloat(t)),validateCoordsArray:([e,t]=[])=>!isNaN(parseFloat(t))&&!isNaN(parseFloat(e)),validateCoord:e=>!isNaN(parseFloat(e)),coordToArray:(e={})=>[e.lon,e.lat],validateCoordinates:({components:e=[],remove:t=!1,type:o}={})=>{if(e&&e.length){const r=e.filter(mo.validateCoords);return t?r.length>mo.COMPONENTS_VALIDATION[o].min&&r.length===e.length:r.length>=mo.COMPONENTS_VALIDATION[o].min&&r.length===e.length}return!1},validateCircle:({components:e=[],properties:t={radius:0}}={})=>{if(e&&e.length){const o=Yt()(e);return!isNaN(parseFloat(t.radius))&&mo.validateCoords(o)}return!1},validateText:({components:e=[],properties:t={valueText:""}}={})=>{if(e&&e.length){const o=Yt()(e);return t&&!!t.valueText&&mo.validateCoords(o)}return!1},validateFeature:({components:e=[[]],type:t,remove:o=!1,properties:r={}}={})=>!se()(t)&&("Text"===t?mo.validateText({components:e,properties:r}):"Circle"===t?mo.validateCircle({components:e,properties:r}):mo.validateCoordinates({components:e,remove:o,type:t})),updateAllStyles:(e={},t={})=>e.features&&e.features.length?{...e,features:e.features.map((e=>E()({},e,{style:Se()(e.style).map((e=>E()({},e,t)))})))}:e,getStartEndPointsForLinestring:()=>[{...wo.Point,highlight:!0,iconAnchor:[.5,.5],type:"Point",title:"StartPoint Style",geometry:"startPoint",filtering:!1,id:oo()()},{...wo.Point,highlight:!0,iconAnchor:[.5,.5],type:"Point",title:"EndPoint Style",geometry:"endPoint",filtering:!1,id:oo()()}],DEFAULT_SHAPE:"triangle",DEFAULT_PATH:"product/assets/symbols/",checkSymbolsError:(e,t="loading_symbols_path")=>e.length&&-1!==ao()(e,(e=>e===t)),isAMissingSymbol:e=>e.symbolUrlCustomized===o(32231),isCompletePolygon:Po,getDashArrayFromStyle:xo,isAnnotation:e=>(null==e?void 0:e.type)===bo||"Annotations"===(null==e?void 0:e.name)};var Eo=o(98090),Lo=o(15565),To=o(79682),Fo=function(e){function t(t,o,r){e.call(this,t),this.features=o,this.coordinate=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(ot.ZP);const Oo=function(e){function t(t){var o,r=t||{};if(e.call(this,r),this.lastCoordinate_=null,this.features_=void 0!==r.features?r.features:null,r.layers)if("function"==typeof r.layers)o=r.layers;else{var i=r.layers;o=function(e){return(0,To.q9)(i,e)}}else o=it.uX;this.layerFilter_=o,this.hitTolerance_=r.hitTolerance?r.hitTolerance:0,this.lastFeature_=null,(0,tt.oL)(this,(0,Qe.v_)(at.Z.ACTIVE),this.handleActiveChanged_,this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.handleDownEvent=function(e){if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);var t=this.features_||new Ct.Z([this.lastFeature_]);return this.dispatchEvent(new Fo("translatestart",t,e.coordinate)),!0}return!1},t.prototype.handleUpEvent=function(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);var t=this.features_||new Ct.Z([this.lastFeature_]);return this.dispatchEvent(new Fo("translateend",t,e.coordinate)),!0}return!1},t.prototype.handleDragEvent=function(e){if(this.lastCoordinate_){var t=e.coordinate,o=t[0]-this.lastCoordinate_[0],r=t[1]-this.lastCoordinate_[1],i=this.features_||new Ct.Z([this.lastFeature_]);i.forEach((function(e){var t=e.getGeometry();t.translate(o,r),e.setGeometry(t)})),this.lastCoordinate_=t,this.dispatchEvent(new Fo("translating",i,t))}},t.prototype.handleMoveEvent=function(e){var t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")},t.prototype.featuresAtPixel_=function(e,t){return t.forEachFeatureAtPixel(e,function(e){if(!this.features_||(0,To.q9)(this.features_.getArray(),e))return e}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})},t.prototype.getHitTolerance=function(){return this.hitTolerance_},t.prototype.setHitTolerance=function(e){this.hitTolerance_=e},t.prototype.setMap=function(t){var o=this.getMap();e.prototype.setMap.call(this,t),this.updateState_(o)},t.prototype.handleActiveChanged_=function(){this.updateState_(null)},t.prototype.updateState_=function(e){var t=this.getMap(),o=this.getActive();t&&o||(t=t||e)&&t.getViewport().classList.remove("ol-grab","ol-grabbing")},t}(nt.Z);var Io=o(49179),Mo=o(19629),Go=o(25753),ko=o(73101),jo="modifyend",Zo=function(e){function t(t,o,r){e.call(this,t),this.features=o,this.mapBrowserEvent=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(ot.ZP);function No(e,t){return e.index-t.index}function Ao(e,t){var o=t.geometry;if(o.getType()===z.Z.CIRCLE){var r=o;if(1===t.index){var i=(0,et.bI)(r.getCenter(),e),s=Math.sqrt(i)-r.getRadius();return s*s}}return(0,et.Bs)(e,t.segment)}function Do(e,t){var o=t.geometry;return o.getType()===z.Z.CIRCLE&&1===t.index?o.getClosestPoint(e):(0,et.oL)(e,t.segment)}const Ro=function(e){function t(t){var o,r;if(e.call(this,t),this.condition_=t.condition?t.condition:rt.Xp,this.defaultDeleteCondition_=function(e){return(0,rt.Ko)(e)&&(0,rt.Kf)(e)},this.deleteCondition_=t.deleteCondition?t.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:rt.Bx,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.modified_=!1,this.rBush_=new ko.Z,this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Ue.Z({source:new Be.Z({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:(o=(0,He.createEditingStyle)(),function(e,t){return o[z.Z.POINT]}),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_},this.source_=null,t.source?(this.source_=t.source,r=new Ct.Z(this.source_.getFeatures()),(0,tt.oL)(this.source_,Go.Z.ADDFEATURE,this.handleSourceAdd_,this),(0,tt.oL)(this.source_,Go.Z.REMOVEFEATURE,this.handleSourceRemove_,this)):r=t.features,!r)throw new Error("The modify interaction requires features or a source");this.features_=r,this.features_.forEach(this.addFeature_.bind(this)),(0,tt.oL)(this.features_,Mo.Z.ADD,this.handleFeatureAdd_,this),(0,tt.oL)(this.features_,Mo.Z.REMOVE,this.handleFeatureRemove_,this),this.lastPointerEvent_=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature_=function(e){var t=e.getGeometry();t&&t.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[t.getType()].call(this,e,t);var o=this.getMap();o&&o.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,o),(0,tt.oL)(e,Ke.Z.CHANGE,this.handleFeatureChange_,this)},t.prototype.willModifyFeatures_=function(e){this.modified_||(this.modified_=!0,this.dispatchEvent(new Zo("modifystart",this.features_,e)))},t.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),(0,tt.Ev)(e,Ke.Z.CHANGE,this.handleFeatureChange_,this)},t.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,o=[];t.forEach((function(t){e===t.feature&&o.push(t)}));for(var r=o.length-1;r>=0;--r)t.remove(o[r])},t.prototype.setActive=function(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.prototype.setActive.call(this,t)},t.prototype.setMap=function(t){this.overlay_.setMap(t),e.prototype.setMap.call(this,t)},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleSourceAdd_=function(e){e.feature&&this.features_.push(e.feature)},t.prototype.handleSourceRemove_=function(e){e.feature&&this.features_.remove(e.feature)},t.prototype.handleFeatureAdd_=function(e){this.addFeature_(e.element)},t.prototype.handleFeatureChange_=function(e){if(!this.changingFeature_){var t=e.target;this.removeFeature_(t),this.addFeature_(t)}},t.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)},t.prototype.writePointGeometry_=function(e,t){var o=t.getCoordinates(),r={feature:e,geometry:t,segment:[o,o]};this.rBush_.insert(t.getExtent(),r)},t.prototype.writeMultiPointGeometry_=function(e,t){for(var o=t.getCoordinates(),r=0,i=o.length;r<i;++r){var s=o[r],n={feature:e,geometry:t,depth:[r],index:r,segment:[s,s]};this.rBush_.insert(t.getExtent(),n)}},t.prototype.writeLineStringGeometry_=function(e,t){for(var o=t.getCoordinates(),r=0,i=o.length-1;r<i;++r){var s=o.slice(r,r+2),n={feature:e,geometry:t,index:r,segment:s};this.rBush_.insert((0,_.hI)(s),n)}},t.prototype.writeMultiLineStringGeometry_=function(e,t){for(var o=t.getCoordinates(),r=0,i=o.length;r<i;++r)for(var s=o[r],n=0,a=s.length-1;n<a;++n){var l=s.slice(n,n+2),p={feature:e,geometry:t,depth:[r],index:n,segment:l};this.rBush_.insert((0,_.hI)(l),p)}},t.prototype.writePolygonGeometry_=function(e,t){for(var o=t.getCoordinates(),r=0,i=o.length;r<i;++r)for(var s=o[r],n=0,a=s.length-1;n<a;++n){var l=s.slice(n,n+2),p={feature:e,geometry:t,depth:[r],index:n,segment:l};this.rBush_.insert((0,_.hI)(l),p)}},t.prototype.writeMultiPolygonGeometry_=function(e,t){for(var o=t.getCoordinates(),r=0,i=o.length;r<i;++r)for(var s=o[r],n=0,a=s.length;n<a;++n)for(var l=s[n],p=0,h=l.length-1;p<h;++p){var c=l.slice(p,p+2),u={feature:e,geometry:t,depth:[n,r],index:p,segment:c};this.rBush_.insert((0,_.hI)(c),u)}},t.prototype.writeCircleGeometry_=function(e,t){var o=t.getCenter(),r={feature:e,geometry:t,index:0,segment:[o,o]},i={feature:e,geometry:t,index:1,segment:[o,o]},s=[r,i];r.featureSegments=i.featureSegments=s,this.rBush_.insert((0,_.HK)(o),r),this.rBush_.insert(t.getExtent(),i)},t.prototype.writeGeometryCollectionGeometry_=function(e,t){for(var o=t.getGeometriesArray(),r=0;r<o.length;++r)this.SEGMENT_WRITERS_[o[r].getType()].call(this,e,o[r])},t.prototype.createOrUpdateVertexFeature_=function(e){var t=this.vertexFeature_;return t?t.getGeometry().setCoordinates(e):(t=new We.Z(new N.Z(e)),this.vertexFeature_=t,this.overlay_.getSource().addFeature(t)),t},t.prototype.handleEvent=function(t){return!t.pointerEvent||(this.lastPointerEvent_=t,t.map.getView().getInteracting()||t.type!=$e.Z.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(o=!(t.type!=$e.Z.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),t.type==$e.Z.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),e.prototype.handleEvent.call(this,t)&&!o);var o},t.prototype.handleDragEvent=function(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e);for(var t=e.coordinate,o=0,r=this.dragSegments_.length;o<r;++o){for(var i=this.dragSegments_[o],s=i[0],n=s.depth,a=s.geometry,l=void 0,p=s.segment,h=i[1];t.length<a.getStride();)t.push(p[h][t.length]);switch(a.getType()){case z.Z.POINT:l=t,p[0]=p[1]=t;break;case z.Z.MULTI_POINT:(l=a.getCoordinates())[s.index]=t,p[0]=p[1]=t;break;case z.Z.LINE_STRING:(l=a.getCoordinates())[s.index+h]=t,p[h]=t;break;case z.Z.MULTI_LINE_STRING:case z.Z.POLYGON:(l=a.getCoordinates())[n[0]][s.index+h]=t,p[h]=t;break;case z.Z.MULTI_POLYGON:(l=a.getCoordinates())[n[1]][n[0]][s.index+h]=t,p[h]=t;break;case z.Z.CIRCLE:p[0]=p[1]=t,0===s.index?(this.changingFeature_=!0,a.setCenter(t),this.changingFeature_=!1):(this.changingFeature_=!0,a.setRadius((0,et.TE)(a.getCenter(),t)),this.changingFeature_=!1)}l&&this.setGeometryCoordinates_(a,l)}this.createOrUpdateVertexFeature_(t)},t.prototype.handleDownEvent=function(e){if(!this.condition_(e))return!1;this.handlePointerAtPixel_(e.pixel,e.map);var t=e.map.getCoordinateFromPixel(e.pixel);this.dragSegments_.length=0,this.modified_=!1;var o=this.vertexFeature_;if(o){var r=[],i=o.getGeometry().getCoordinates(),s=(0,_.hI)([i]),n=this.rBush_.getInExtent(s),a={};n.sort(No);for(var l=0,p=n.length;l<p;++l){var h=n[l],c=h.segment,u=(0,Io.sq)(h.feature),d=h.depth;if(d&&(u+="-"+d.join("-")),a[u]||(a[u]=new Array(2)),h.geometry.getType()===z.Z.CIRCLE&&1===h.index){var m=Do(t,h);(0,et.fS)(m,i)&&!a[u][0]&&(this.dragSegments_.push([h,0]),a[u][0]=h)}else if((0,et.fS)(c[0],i)&&!a[u][0])this.dragSegments_.push([h,0]),a[u][0]=h;else if((0,et.fS)(c[1],i)&&!a[u][1]){if((h.geometry.getType()===z.Z.LINE_STRING||h.geometry.getType()===z.Z.MULTI_LINE_STRING)&&a[u][0]&&0===a[u][0].index)continue;this.dragSegments_.push([h,1]),a[u][1]=h}else this.insertVertexCondition_(e)&&(0,Io.sq)(c)in this.vertexSegments_&&!a[u][0]&&!a[u][1]&&r.push([h,i])}r.length&&this.willModifyFeatures_(e);for(var g=r.length-1;g>=0;--g)this.insertVertex_.apply(this,r[g])}return!!this.vertexFeature_},t.prototype.handleUpEvent=function(e){for(var t=this.dragSegments_.length-1;t>=0;--t){var o=this.dragSegments_[t][0],r=o.geometry;if(r.getType()===z.Z.CIRCLE){var i=r.getCenter(),s=o.featureSegments[0],n=o.featureSegments[1];s.segment[0]=s.segment[1]=i,n.segment[0]=n.segment[1]=i,this.rBush_.update((0,_.HK)(i),s),this.rBush_.update(r.getExtent(),n)}else this.rBush_.update((0,_.hI)(o.segment),o)}return this.modified_&&(this.dispatchEvent(new Zo(jo,this.features_,e)),this.modified_=!1),!1},t.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map)},t.prototype.handlePointerAtPixel_=function(e,t){var o=t.getCoordinateFromPixel(e),r=(0,_.f3)((0,_.HK)(o),t.getView().getResolution()*this.pixelTolerance_),i=this.rBush_.getInExtent(r);if(i.length>0){i.sort((function(e,t){return Ao(o,e)-Ao(o,t)}));var s=i[0],n=s.segment,a=Do(o,s),l=t.getPixelFromCoordinate(a),p=(0,et.TE)(e,l);if(p<=this.pixelTolerance_){var h={};if(s.geometry.getType()===z.Z.CIRCLE&&1===s.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(a);else{var c=t.getPixelFromCoordinate(n[0]),u=t.getPixelFromCoordinate(n[1]),d=(0,et.bI)(l,c),m=(0,et.bI)(l,u);p=Math.sqrt(Math.min(d,m)),this.snappedToVertex_=p<=this.pixelTolerance_,this.snappedToVertex_&&(a=d>m?n[1]:n[0]),this.createOrUpdateVertexFeature_(a);for(var g=1,y=i.length;g<y;++g){var f=i[g].segment;if(!((0,et.fS)(n[0],f[0])&&(0,et.fS)(n[1],f[1])||(0,et.fS)(n[0],f[1])&&(0,et.fS)(n[1],f[0])))break;h[(0,Io.sq)(f)]=!0}}return h[(0,Io.sq)(n)]=!0,void(this.vertexSegments_=h)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},t.prototype.insertVertex_=function(e,t){for(var o,r=e.segment,i=e.feature,s=e.geometry,n=e.depth,a=e.index;t.length<s.getStride();)t.push(0);switch(s.getType()){case z.Z.MULTI_LINE_STRING:case z.Z.POLYGON:(o=s.getCoordinates())[n[0]].splice(a+1,0,t);break;case z.Z.MULTI_POLYGON:(o=s.getCoordinates())[n[1]][n[0]].splice(a+1,0,t);break;case z.Z.LINE_STRING:(o=s.getCoordinates()).splice(a+1,0,t);break;default:return}this.setGeometryCoordinates_(s,o);var l=this.rBush_;l.remove(e),this.updateSegmentIndices_(s,a,n,1);var p={segment:[r[0],t],feature:i,geometry:s,depth:n,index:a};l.insert((0,_.hI)(p.segment),p),this.dragSegments_.push([p,1]);var h={segment:[t,r[1]],feature:i,geometry:s,depth:n,index:a+1};l.insert((0,_.hI)(h.segment),h),this.dragSegments_.push([h,0]),this.ignoreNextSingleClick_=!0},t.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=$e.Z.POINTERDRAG){var e=this.lastPointerEvent_;return this.willModifyFeatures_(e),this.removeVertex_(),this.dispatchEvent(new Zo(jo,this.features_,e)),this.modified_=!1,!0}return!1},t.prototype.removeVertex_=function(){var e,t,o,r,i,s,n,a,l,p,h,c=this.dragSegments_,u={},d=!1;for(i=c.length-1;i>=0;--i)p=(o=c[i])[0],h=(0,Io.sq)(p.feature),p.depth&&(h+="-"+p.depth.join("-")),h in u||(u[h]={}),0===o[1]?(u[h].right=p,u[h].index=p.index):1==o[1]&&(u[h].left=p,u[h].index=p.index+1);for(h in u){switch(l=u[h].right,n=u[h].left,(a=(s=u[h].index)-1)<0&&(a=0),e=t=(r=(p=void 0!==n?n:l).geometry).getCoordinates(),d=!1,r.getType()){case z.Z.MULTI_LINE_STRING:t[p.depth[0]].length>2&&(t[p.depth[0]].splice(s,1),d=!0);break;case z.Z.LINE_STRING:t.length>2&&(t.splice(s,1),d=!0);break;case z.Z.MULTI_POLYGON:e=e[p.depth[1]];case z.Z.POLYGON:(e=e[p.depth[0]]).length>4&&(s==e.length-1&&(s=0),e.splice(s,1),d=!0,0===s&&(e.pop(),e.push(e[0]),a=e.length-1))}if(d){this.setGeometryCoordinates_(r,t);var m=[];if(void 0!==n&&(this.rBush_.remove(n),m.push(n.segment[0])),void 0!==l&&(this.rBush_.remove(l),m.push(l.segment[1])),void 0!==n&&void 0!==l){var g={depth:p.depth,feature:p.feature,geometry:p.geometry,index:a,segment:m};this.rBush_.insert((0,_.hI)(g.segment),g)}this.updateSegmentIndices_(r,s,p.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),c.length=0}}return d},t.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1},t.prototype.updateSegmentIndices_=function(e,t,o,r){this.rBush_.forEachInExtent(e.getExtent(),(function(i){i.geometry===e&&(void 0===o||void 0===i.depth||(0,To.fS)(i.depth,o))&&i.index>t&&(i.index+=r)}))},t}(nt.Z);var Vo=o(47588),zo=o(13580),Bo=function(e){function t(t,o,r,i){e.call(this,t),this.selected=o,this.deselected=r,this.mapBrowserEvent=i}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(ot.ZP);function Uo(e){if(!this.condition_(e))return!0;var t=this.addCondition_(e),o=this.removeCondition_(e),r=this.toggleCondition_(e),i=!t&&!o&&!r,s=e.map,n=this.getFeatures(),a=[],l=[];if(i){(0,zo.ZH)(this.featureLayerAssociation_),s.forEachFeatureAtPixel(e.pixel,function(e,t){if(this.filter_(e,t))return l.push(e),this.addFeatureLayerAssociation_(e,t),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var p=n.getLength()-1;p>=0;--p){var h=n.item(p),c=l.indexOf(h);c>-1?l.splice(c,1):(n.remove(h),a.push(h))}0!==l.length&&n.extend(l)}else{s.forEachFeatureAtPixel(e.pixel,function(e,i){if(this.filter_(e,i))return!t&&!r||(0,To.q9)(n.getArray(),e)?(o||r)&&(0,To.q9)(n.getArray(),e)&&(a.push(e),this.removeFeatureLayerAssociation_(e)):(l.push(e),this.addFeatureLayerAssociation_(e,i)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var u=a.length-1;u>=0;--u)n.remove(a[u]);n.extend(l)}return(l.length>0||a.length>0)&&this.dispatchEvent(new Bo("select",l,a,e)),(0,rt.MJ)(e)}const Wo=function(e){function t(t){e.call(this,{handleEvent:Uo});var o=t||{};this.condition_=o.condition?o.condition:rt.Kf,this.addCondition_=o.addCondition?o.addCondition:rt.Fi,this.removeCondition_=o.removeCondition?o.removeCondition:rt.Fi,this.toggleCondition_=o.toggleCondition?o.toggleCondition:rt.vY,this.multi_=!!o.multi&&o.multi,this.filter_=o.filter?o.filter:it.uX,this.hitTolerance_=o.hitTolerance?o.hitTolerance:0;var r,i,s=new Ue.Z({source:new Be.Z({useSpatialIndex:!1,features:o.features,wrapX:o.wrapX}),style:o.style?o.style:(i=(0,He.createEditingStyle)(),(0,To.l7)(i[z.Z.POLYGON],i[z.Z.LINE_STRING]),(0,To.l7)(i[z.Z.GEOMETRY_COLLECTION],i[z.Z.LINE_STRING]),function(e,t){return e.getGeometry()?i[e.getGeometry().getType()]:null}),updateWhileAnimating:!0,updateWhileInteracting:!0});if(this.featureOverlay_=s,o.layers)if("function"==typeof o.layers)r=o.layers;else{var n=o.layers;r=function(e){return(0,To.q9)(n,e)}}else r=it.uX;this.layerFilter_=r,this.featureLayerAssociation_={};var a=this.getFeatures();(0,tt.oL)(a,Mo.Z.ADD,this.addFeature_,this),(0,tt.oL)(a,Mo.Z.REMOVE,this.removeFeature_,this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeatureLayerAssociation_=function(e,t){this.featureLayerAssociation_[(0,Io.sq)(e)]=t},t.prototype.getFeatures=function(){return this.featureOverlay_.getSource().getFeaturesCollection()},t.prototype.getHitTolerance=function(){return this.hitTolerance_},t.prototype.getLayer=function(e){return this.featureLayerAssociation_[(0,Io.sq)(e)]},t.prototype.getOverlay=function(){return this.featureOverlay_},t.prototype.setHitTolerance=function(e){this.hitTolerance_=e},t.prototype.setMap=function(t){var o=this.getMap(),r=this.getFeatures();o&&r.forEach(o.unskipFeature.bind(o)),e.prototype.setMap.call(this,t),this.featureOverlay_.setMap(t),t&&r.forEach(t.skipFeature.bind(t))},t.prototype.addFeature_=function(e){var t=this.getMap();t&&t.skipFeature(e.element)},t.prototype.removeFeature_=function(e){var t=this.getMap();t&&t.unskipFeature(e.element)},t.prototype.removeFeatureLayerAssociation_=function(e){delete this.featureLayerAssociation_[(0,Io.sq)(e)]},t}(Vo.ZP);function Ho(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const qo=new Te.Z;class Yo extends S().Component{constructor(...e){super(...e),Ho(this,"getNewFeature",((e,t,o,r)=>new We.Z({geometry:this.createOLGeometry({type:e,coordinates:t,radius:o,center:r})}))),Ho(this,"getMapCrs",(()=>this.props.map.getView().getProjection().getCode())),Ho(this,"updateFeatureStyles",(e=>{e&&e.length>0&&e.forEach((e=>{if(e.style){let t=this.toOlFeature(e);t&&t.setStyle(e.style?(0,Pe.C2)(e):this.toOlStyle(e.style,e.selected))}}))})),Ho(this,"updateOnlyFeatureStyles",(e=>{this.drawLayer&&this.drawLayer.getSource().getFeatures().forEach((t=>{let o=Yt()(e.features).features||e.features,r=Q()(o,(e=>e.properties.id===t.getProperties().id));if(r){let e=(0,Le.createStylesAsync)(Se()(r.style));we().all(e).then((e=>{t.setStyle((()=>(0,Pe.Cw)({...r,style:e})))}))}}))})),Ho(this,"addLayer",((e,t)=>{let o=null;const r=this.convertGeometryTypeToStyleType(e.drawMethod);o=t=>{let o=Yt()(e.features)&&Q()(Yt()(e.features).features,(e=>e.properties.id===t.getProperties().id))||null;if(o){let e=(0,Le.createStylesAsync)(Se()(o.style));return we().all(e).then((e=>{t.setStyle((()=>(0,Pe.Cw)({...o,style:e})))})),null}return(0,Pe.Cw)({style:Pe.jF[r]})},this.geojson=new Te.Z,this.drawSource=new Be.Z,this.drawLayer=new Ue.Z({source:this.drawSource,zIndex:1e8,style:o}),this.props.map.addLayer(this.drawLayer),t&&this.addInteractions(e);let i=Yt()(e.features);if(i&&i.features&&i.features.length){const t=i.features.filter((t=>!t.properties.isCircle||t.properties.isCircle&&!t.properties.canEdit||!e.options.drawEnabled));return this.addFeatures(E()({},e,{features:[{...i,features:t}]}))}return this.addFeatures(e)})),Ho(this,"addFeatures",(({features:e,drawMethod:t,options:o})=>{const r=this.getMapCrs();let i;if(e.forEach((e=>{if("FeatureCollection"===e.type){let t=(new Te.Z).readFeatures(e);o.geodesic||(t=t.map((e=>Ee(e,r)))),this.drawSource=new Be.Z({features:t}),this.drawLayer.setSource(this.drawSource)}else{let n=null,a=e;var s;if(a.geometry&&"GeometryCollection"!==a.geometry.type&&(a=(0,L.reprojectGeoJson)(a,a.featureProjection,r).geometry),"GeometryCollection"!==a.type)"Circle"===t&&a&&(a.properties&&a.properties.center||a.center)?(n=a.properties&&a.properties.center?(0,L.reproject)(a.properties.center,"EPSG:4326",r):a.center,n=[n.x,n.y],i=new We.Z({geometry:this.createOLGeometry({type:"Circle",center:n,projection:"EPSG:3857",radius:a.properties&&a.properties.radius||a.radius,options:o})})):i=new We.Z({geometry:this.createOLGeometry(a.geometry?a.geometry:{...a,radius:null===(s=a.properties)||void 0===s?void 0:s.radius,center:n})}),i.setProperties(e.properties),this.drawSource.addFeature(i)}})),0===e.length&&(o.editEnabled||o.drawEnabled))o.transformToFeatureCollection?(this.drawSource=new Be.Z({features:(new Te.Z).readFeatures({type:"FeatureCollection",features:[]})}),this.drawLayer.setSource(this.drawSource)):(i=new We.Z({geometry:this.createOLGeometry({type:t,coordinates:null})}),this.drawSource.addFeature(i));else{if(e[0]&&"GeometryCollection"===e[0].type){this.drawSource=new Be.Z({features:(new Te.Z).readFeatures(e[0])});let t=this.replacePolygonsWithCircles(this.drawSource.getFeatures()[0]);this.drawSource.getFeatures()[0].getGeometry().setGeometries(t),this.drawLayer.setSource(this.drawSource)}e[0]&&e[0].geometry&&"GeometryCollection"===e[0].geometry.type&&(i=(0,L.reprojectGeoJson)(e[0],o.featureProjection,r).geometry,this.drawSource=new Be.Z({features:(new Te.Z).readFeatures(i)}),this.drawSource.getFeatures()[0].set("textGeometriesIndexes",e[0].properties&&e[0].properties.textGeometriesIndexes),this.drawSource.getFeatures()[0].set("textValues",e[0].properties&&e[0].properties.textValues),this.drawSource.getFeatures()[0].set("circles",e[0].properties&&e[0].properties.circles),this.drawLayer.setSource(this.drawSource))}return this.updateFeatureStyles(e),i})),Ho(this,"replaceFeatures",(e=>{let t;return this.drawLayer?(this.drawSource.clear(),t=this.addFeatures(e),e.style&&this.drawLayer.setStyle((t=>{let o=Q()(Yt()(e.features).features,(e=>e.properties.id===t.getProperties().id));if(o){let e=(0,Le.createStylesAsync)(Se()(o.style));return we().all(e).then((e=>{t.setStyle((()=>(0,Pe.Cw)({...o,style:e})))})),null}const r=this.convertGeometryTypeToStyleType(e.drawMethod);return(0,Pe.Cw)({style:Pe.jF[r]})}))):t=this.addLayer(e,e.options&&e.options.drawEnabled||!1),t})),Ho(this,"endDrawing",(e=>{const t=this.replaceFeatures(e);if(t){const o=this.fromOLFeature(t);"Circle"===e.drawMethod&&e&&e.features&&e.features.length&&e.features[0]&&e.features[0].radius>=0&&(o.radius=e.features[0].radius),this.props.onEndDrawing(o,e.drawOwner)}})),Ho(this,"addDrawInteraction",((e,t,o,r)=>{this.drawInteraction&&this.removeDrawInteraction(),this.drawInteraction=new mt(this.drawPropertiesForGeometryType(e,o,this.drawSource,r)),this.props.map.disableEventListener("singleclick"),this.drawInteraction.on("drawstart",(()=>{this.selectInteraction&&(this.selectInteraction.getFeatures().clear(),this.selectInteraction.setActive(!1))})),this.drawInteraction.on("drawend",(e=>{const o=e.feature.clone();if(o.set("id",eo().v1()),"Circle"===this.props.drawMethod&&"Circle"===o.getGeometry().getType()){const e=o.getGeometry().getRadius(),t=o.getGeometry().getCenter();o.setGeometry(this.polygonFromCircle(t,e))}const r=this.fromOLFeature(o,t);this.props.onEndDrawing(r,this.props.drawOwner),this.props.options.stopAfterDrawing&&this.props.onChangeDrawingStatus("stop",this.props.drawMethod,this.props.drawOwner,this.props.features.concat([r])),this.selectInteraction&&(this.addSelectInteraction(),this.selectInteraction.setActive(!0))})),this.props.map.addInteraction(this.drawInteraction),this.setDoubleClickZoomEnabled(!1)})),Ho(this,"toMulti",(e=>"Point"===e.getType()?new D.Z([e.getCoordinates()]):e)),Ho(this,"handleDrawAndEdit",((e,t,o,r)=>{this.drawInteraction&&this.removeDrawInteraction(),this.drawInteraction=new mt(this.drawPropertiesForGeometryType((0,F.getSimpleGeomType)(e),o,(0,F.isSimpleGeomType)(e)?this.drawSource:null,r)),this.props.map.disableEventListener("singleclick"),this.drawInteraction.on("drawstart",(()=>{this.selectInteraction&&(this.selectInteraction.getFeatures().clear(),this.selectInteraction.setActive(!1))})),this.drawInteraction.on("drawend",(o=>{const i=o.feature.clone(),s=eo().v1();i.set("id",s);let n,a,l,p=i.getGeometry(),h=this.drawLayer.getSource().getFeatures(),c=this.props.features;if(this.props.options.transformToFeatureCollection){let t;if("Circle"===e){let e,i,n;if(l="Polygon",this.props.options.geodesic){i=o.feature.getGeometry().geodesicCenter||(0,_.qg)(p.getExtent());const t=this.props.map.getView().getProjection().getCode(),r=[[...i],[...p.getCoordinates()[0][0]]].map((e=>this.reprojectCoordinatesToWGS84(e,t)));e=(0,L.calculateDistance)(r,"haversine"),n=(0,q.iu)(r[0],e).clone().transform("EPSG:4326",t).getCoordinates()}else e=p.getRadius(),i=p.getCenter(),n=this.polygonCoordsFromCircle(i,e);t=this.getNewFeature(l,n),i=(0,L.reproject)(i,this.getMapCrs(),"EPSG:4326",!1);const a=r&&r.features&&r.features.length&&r.features[0]&&r.features[0].features&&r.features[0].features.length&&r.features[0].features.filter((e=>e.properties.isDrawing))[0].properties.id||s;t.setProperties({isCircle:!0,radius:e,center:[i.x,i.y],id:a,crs:this.getMapCrs(),isGeodesic:this.props.options.geodesic})}else if("Polygon"===e){l=this.props.drawMethod;let e=p.getCoordinates();e[0].push(e[0][0]),t=this.getNewFeature(l,e)}else{l="Text"===e?"Point":this.props.drawMethod;let o=p.getCoordinates();t=this.getNewFeature(l,o),"Text"===e&&t.setProperties({isText:!0,valueText:"."})}const i=h.length>=1?[...this.replaceCirclesWithPolygonsInFeatureColl(h)]:[];t.getProperties().id||t.setProperties({id:eo().v1()});const n=[...i,t];let a=qo.writeFeaturesObject(n);const c=new Be.Z({features:(new Te.Z).readFeatures(a)});this.drawLayer.setSource(c);let u=(0,L.reprojectGeoJson)(a,this.getMapCrs(),"EPSG:4326");this.props.onGeometryChanged([u],this.props.drawOwner,this.props.options&&this.props.options.stopAfterDrawing?"enterEditMode":"","Text"===e,"Circle"===e),this.props.onEndDrawing(u,this.props.drawOwner),this.props.onDrawingFeatures([Ae()(u.features)])}else{if("Circle"===e){l="Polygon";const e=p.getRadius(),t=p.getCenter(),o=this.polygonCoordsFromCircle(t,e),r=this.toMulti(this.createOLGeometry({type:l,coordinates:o}));if(1===c.length&&c[0]&&!c[0].geometry)n=[],a=new Eo.default([r]);else if(n=this.toMulti(Yt()(h).getGeometry()),n.getGeometries){const e=this.replaceCirclesWithPolygons(Yt()(h));a=new Eo.default([...e,r])}else a=new Eo.default([n,r]);i.setGeometry(a)}else if("Text"===e||"MultiPoint"===e){let e=p.getCoordinates();l="MultiPoint";let t=this.toMulti(this.createOLGeometry({type:l,coordinates:[e]}));if(1!==c.length||c[0].geometry)if(n=this.toMulti(Yt()(h).getGeometry()),n.getGeometries){let e=this.replaceCirclesWithPolygons(Yt()(h));a=new Eo.default([...e,t])}else a=n.clone(),a.appendPoint(t.getPoint(0));else n=[],a=t.clone();i.setGeometry(a)}else if(!(0,F.isSimpleGeomType)(e)){let t;a=null,n=1!==c.length||c[0].geometry?this.toMulti(Yt()(h).getGeometry()):this.toMulti(this.createOLGeometry({type:e,coordinates:null}));let o=h.map((e=>"GeometryCollection"===e.getGeometry().getType()?e.getGeometry().getGeometries():e.getGeometry()));"GeometryCollection"===h[0].getGeometry().getType()&&(o=o[0]);let r=Q()(o,(t=>t.getType()===e));if(r?this.appendToMultiGeometry(e,r,p):t=this.toMulti(this.createOLGeometry({type:e,coordinates:p.getCoordinates()})),p.getType()!==(0,F.getSimpleGeomType)(n.getType())){let o=Yt()(h).getGeometry().getGeometries?this.replaceCirclesWithPolygons(Yt()(h)):[];if(r){let e=o.map((e=>e.getType()===r.getType()?r:e));a=new Eo.default(e)}else a="GeometryCollection"===n.getType()?new Eo.default([...o,t]):"Text"===e?new Eo.default([t]):new Eo.default([n,t]);i.setGeometry(a)}else i.setGeometry(r)}let o=this.props.features[0].properties;"Text"===e&&(o=E()({},this.props.features[0].properties,{textValues:(this.props.features[0].properties.textValues||[]).concat(["."]),textGeometriesIndexes:(this.props.features[0].properties.textGeometriesIndexes||[]).concat([i.getGeometry().getGeometries().length-1])})),"Circle"===e&&(o=E()({},o,{circles:(this.props.features[0].properties.circles||[]).concat([i.getGeometry().getGeometries().length-1])}));let r=this.fromOLFeature(i,t,o);const s=new Be.Z({features:(new Te.Z).readFeatures(r)});this.drawLayer.setSource(s);let u=(0,L.reprojectGeoJson)(qo.writeFeatureObject(i.clone()),this.getMapCrs(),"EPSG:4326");"Polygon"===u.geometry.type&&u.geometry.coordinates[0].push(u.geometry.coordinates[0][0]),this.props.onGeometryChanged([u],this.props.drawOwner,this.props.options&&this.props.options.stopAfterDrawing?"enterEditMode":"","Text"===e,"Circle"===e),this.props.onEndDrawing(r,this.props.drawOwner),r=(0,L.reprojectGeoJson)(r,this.getMapCrs(),"EPSG:4326");const d=(0,F.isSimpleGeomType)(this.props.drawMethod)&&"GeometryCollection"!==this.props.features[0].geometry.type?this.props.features.map((e=>({...e,featureProjection:this.getMapCrs()}))).concat([{...r,type:"Feature",geometry:{type:r.type,coordinates:r.coordinates},featureProjection:this.getMapCrs(),properties:o}]):[{...r,properties:o}];this.props.options.stopAfterDrawing?this.props.onChangeDrawingStatus("stop",this.props.drawMethod,this.props.drawOwner,d):this.props.onChangeDrawingStatus("replace",this.props.drawMethod,this.props.drawOwner,d.map((e=>(0,L.reprojectGeoJson)(e,"EPSG:4326",this.getMapCrs()))),E()({},this.props.options,{featureProjection:this.getMapCrs()})),this.selectInteraction&&(this.addSelectInteraction(),this.selectInteraction.setActive(!0))}})),this.props.map.addInteraction(this.drawInteraction),this.setDoubleClickZoomEnabled(!1)})),Ho(this,"drawPropertiesForGeometryType",((e,t,o,r={})=>{let i={source:this.drawSource||o,type:e,style:"Marker"===e?(0,Pe.Fc)(r.style):new He.default({fill:new qe.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new Ye.default({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new Xe.default({radius:5,stroke:new Ye.default({color:"rgba(0, 0, 0, 0.7)"}),fill:new qe.default({color:"rgba(255, 255, 255, 0.2)"})})}),features:new Ct.Z,condition:rt.Bx},s={};switch(e){case"BBOX":s.type="LineString",s.maxPoints=2,s.geometryFunction=function(e,t){let o=t;o||(o=new q.ZP([]));let r=e[0],i=e[1];return o.setCoordinates([[r,[r[0],i[1]],i,[i[0],r[1]],r]]),o};break;case"Circle":s.maxPoints=100,r.options&&r.options.geodesic?s.geometryFunction=(e,t)=>{let o=t;o||(o=new q.ZP([]),o.setProperties({geodesicCenter:[...e[0]]},!0));let r=this.props.map.getView().getProjection().getCode(),i=[...e].map((e=>this.reprojectCoordinatesToWGS84(e,r))),s=(0,L.calculateDistance)(i,"haversine"),n=(0,q.iu)(i[0],s).clone().transform("EPSG:4326",r).getCoordinates();return o.setCoordinates(n),o}:s.type=e;break;case"Marker":case"Point":case"Text":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":{"LineString"===e&&(s.maxPoints=t);let o="Text"===e||"Marker"===e?"Point":e;s.type=o,s.geometryFunction=(e,t)=>{let i=t;return i||(i=this.createOLGeometry({type:o,coordinates:null,options:r.options})),i.setCoordinates(e),i};break}default:return{}}return E()({},i,s)})),Ho(this,"setDoubleClickZoomEnabled",(e=>{let t=this.props.map.getInteractions();for(let o=0;o<t.getLength();o++){let r=t.item(o);if(r instanceof I.Z){r.setActive(e);break}}})),Ho(this,"updateFeatureExtent",(e=>{const t=e.features.getArray(),o=this.props.features.map((e=>{const o=Yt()(t.filter((t=>this.fromOLFeature(t).id===e.id)));return o?E()({},e,{geometry:o.geometry,center:o.center,extent:o.extent,coordinate:o.coordinates,radius:o.radius}):e}));this.props.onChangeDrawingStatus("replace",this.props.drawMethod,this.props.drawOwner,o)})),Ho(this,"addInteractions",(e=>{this.clean(),this.drawLayer||this.addLayer(e),this.addDrawInteraction(e.drawMethod,e.options.startingPoint,e.options.maxPoints,e),e.options&&e.options.editEnabled&&(this.addSelectInteraction(),this.translateInteraction&&this.props.map.removeInteraction(this.translateInteraction),this.translateInteraction=new Oo({features:this.selectInteraction.getFeatures()}),this.translateInteraction.setActive(!1),this.translateInteraction.on("translateend",this.updateFeatureExtent),this.props.map.addInteraction(this.translateInteraction),this.addTranslateListener(),this.modifyInteraction&&this.props.map.removeInteraction(this.modifyInteraction),this.modifyInteraction=new Ro({features:this.selectInteraction.getFeatures(),condition:e=>(0,rt.Xp)(e)&&!(0,rt.Ko)(e)}),this.props.map.addInteraction(this.modifyInteraction)),this.drawSource.clear(),e.features.length>0&&this.addFeatures(e)})),Ho(this,"addSingleClickListener",((e,t)=>t.map.on("singleclick",e))),Ho(this,"addDrawOrEditInteractions",(e=>{this.state&&this.state.keySingleClickCallback&&(0,gt.B)(this.state.keySingleClickCallback);this.clean();let t,o=e.features.map((t=>(0,L.reprojectGeoJson)(t,e.options.featureProjection,this.getMapCrs())||{}));const r=o.every((e=>!!(e&&e.features&&e.features.length))),i=o.every((e=>!!(e&&e.properties&&e.properties.isCircle)));if(r)t=E()({},e,{features:o});else if(i)t=E()({},e,{features:[]});else{const r=o.reduce(((e,t)=>t.geometry?[...e,{...t.geometry,properties:t.properties}]:e),[]);t=E()({},e,{features:r})}this.drawLayer?(this.drawSource.clear(),this.addFeatures(t)):this.addLayer(t),e.options.editEnabled&&(!e.options.geodesic&&this.addModifyInteraction(e),!1!==e.options.translateEnabled&&this.addTranslateInteraction(),e.options.addClickCallback&&this.setState({keySingleClickCallback:this.addSingleClickListener((t=>{if(this.drawSource&&e.options){let o=this.drawSource.getFeatures(),r=0;const i=o&&o.length&&o.filter(((e,t)=>(e.getProperties().canEdit&&(r=t),e.getProperties().canEdit)))[0]||null,s=i&&i.getGeometry()&&i.getGeometry().getCoordinates&&i.getGeometry().getCoordinates()||[];let n,l=[],p=e.drawMethod;switch(p){case"Polygon":s.length?Po(s)?(l=Kt()(s[0],0,s[0].length-1),l=l.concat([t.coordinate]),l=[l.concat([s[0][0]])]):l=s[0].length>1?[[...s[0],t.coordinate,s[0][0]]]:[[...s[0],t.coordinate]]:l=[[t.coordinate]],n=this.getNewFeature(p,l),n.setProperties(a()(i&&i.getProperties()||{},"geometry"));break;case"LineString":case"MultiPoint":l=s.length?[...s,t.coordinate]:[t.coordinate],n=this.getNewFeature(p,l),n.setProperties(a()(i&&i.getProperties()||{},"geometry"));break;case"Circle":{p="Polygon";const o=i&&i.getProperties()&&i.getProperties().radius||1e4;let r=t.coordinate,s=this.polygonCoordsFromCircle(r,o);if(e.options.geodesic){const e=this.props.map.getView().getProjection().getCode(),t=[[...r]].map((t=>this.reprojectCoordinatesToWGS84(t,e)));s=(0,q.iu)(t[0],o).clone().transform("EPSG:4326",e).getCoordinates()}n=this.getNewFeature(p,s),r=(0,L.reproject)(r,this.getMapCrs(),"EPSG:4326",!1),n.setProperties(a()(i&&i.getProperties()||{},"geometry")),n.setProperties({isCircle:!0,radius:o,center:[r.x,r.y],isGeodesic:this.props.options.geodesic});break}case"Text":p="Point",n=this.getNewFeature(p,t.coordinate),n.setProperties(a()(i&&i.getProperties()||{},"geometry")),n.setProperties({isText:!0,valueText:i&&i.getProperties()&&i.getProperties().valueText||e.options.defaultTextAnnotation||"New"});break;default:l=t.coordinate,n=this.getNewFeature(p,l),n.setProperties(a()(i&&i.getProperties()||{},"geometry"))}let h={type:"Feature",geometry:{coordinates:[...(0,L.reprojectGeoJson)(qo.writeFeaturesObject([n.clone()]),this.getMapCrs(),"EPSG:4326").features[0].geometry.coordinates],type:p},properties:{...a()(n.getProperties(),"geometry")}};this.props.onDrawingFeatures([h]),e.options.geodesic||(n=Ee(n,this.getMapCrs())),o[r]=n,this.drawSource=new Be.Z({features:o}),this.drawLayer.setSource(this.drawSource),this.addModifyInteraction(e)}}),e)})),e.options&&e.options.selectEnabled&&this.addSelectInteraction(e.options&&e.options.selected,e),e.options.drawEnabled&&this.handleDrawAndEdit(e.drawMethod,e.options.startingPoint,e.options.maxPoints,e)})),Ho(this,"addSelectInteraction",((e,t)=>{let o;if(this.selectInteraction&&this.props.map.removeInteraction(this.selectInteraction),e&&(o=Q()(this.drawSource.getFeatures(),(t=>t.getProperties().id===e.properties.id)),o&&this.selectFeature(o)),this.selectInteraction=new Wo({layers:[this.drawLayer],features:new Ct.Z(e&&o?[o]:null)}),o){const e=this.convertGeometryTypeToStyleType(t.drawMethod);o.setStyle((0,Pe.C2)({...t,style:{...t.style,type:e,highlight:!0,useSelectedStyle:t.options.useSelectedStyle}},!1,t.features[0]&&t.features[0].properties&&t.features[0].properties.valueText&&[t.features[0].properties.valueText]||[]))}this.selectInteraction.on("select",(e=>{let t=this.selectInteraction.getFeatures().getArray(),o=[];return t.length&&(o=this.props.features.map((o=>{let r=!1;if("FeatureCollection"===o.type&&t.length>0){let e=Yt()(t);if(this.selectFeature(e),e.getGeometry&&"Circle"===e.getGeometry().getType()){let t=e.getGeometry().getRadius(),o=(0,L.reproject)(e.getGeometry().getCenter(),this.getMapCrs(),"EPSG:4326");e.setProperties({center:[o.x,o.y],radius:t}),e=this.replaceCircleWithPolygon(e.clone())}return this.drawSource.getFeatures().forEach((t=>{t.getProperties().id===e.getProperties().id?this.selectFeature(e):this.deselectFeature(t)})),(0,L.reprojectGeoJson)(qo.writeFeatureObject(e.clone()),this.getMapCrs(),"EPSG:4326")}return r=t.reduce(((e,t)=>t.get("id")===o.id||e),!1),E()({},o,{selected:r,selectedFeature:e.selected})})),this.props.onSelectFeatures(o)),0===t.length?(this.props.onSelectFeatures([]),this.drawSource.getFeatures().map((e=>this.deselectFeature(e))),null):null})),this.props.map.addInteraction(this.selectInteraction)})),Ho(this,"selectFeature",(e=>{e.setProperties({selected:!0})})),Ho(this,"deselectFeature",(e=>{e.setProperties({selected:!1})})),Ho(this,"removeDrawInteraction",(()=>{this.drawInteraction&&(this.props.map.removeInteraction(this.drawInteraction),this.drawInteraction=null,setTimeout((()=>this.props.map.enableEventListener("singleclick")),500),setTimeout((()=>this.setDoubleClickZoomEnabled(!0)),250))})),Ho(this,"removeInteractions",(()=>{this.removeDrawInteraction(),this.selectInteraction&&(this.props.map.enableEventListener("singleclick"),this.props.map.removeInteraction(this.selectInteraction)),this.modifyInteraction&&(this.props.map.removeInteraction(this.modifyInteraction),this.props.map.un("singleclick")),this.translateInteraction&&this.props.map.removeInteraction(this.translateInteraction)})),Ho(this,"clean",(e=>{e||this.removeInteractions(),this.drawLayer&&(this.props.map.removeLayer(this.drawLayer),this.geojson=null,this.drawLayer=null,this.drawSource=null)})),Ho(this,"fromOLFeature",((e,t,o)=>{const r=e.getGeometry(),i=this.props.map.getView().getProjection().getCode(),s=r.getType();if(r.getCoordinates){const o=r.getExtent(),n=r.getProperties(),a=n&&n.geodesicCenter||(0,_.qg)(o);let l,p=r.getCoordinates();if(t&&(p=Ht()(t,p),r.setCoordinates(p)),"Circle"===this.props.drawMethod)if(this.props.options.geodesic){const e=[[...a],[...p[0][0]]].map((e=>this.reprojectCoordinatesToWGS84(e,i)));l=(0,L.calculateDistance)(e,"haversine")}else l=this.calculateRadius(a,p);return E()({},{id:e.get("id"),type:s,extent:o,center:a,coordinates:p,radius:l,style:this.fromOlStyle(e.getStyle()),projection:this.getMapCrs()})}let n=r.getGeometries().map(((r,s)=>{const n=r.getExtent(),a=(0,_.qg)(n);let l,p=r.getCoordinates();if(t&&(p=Ht()(t,p),r.setCoordinates(p)),o.circles&&-1!==o.circles.indexOf(s))if(this.props.options.geodesic){const e=[[...a],[...p[0][0]]].map((e=>this.reprojectCoordinatesToWGS84(e,i)));l=(0,L.calculateDistance)(e,"haversine")}else l=this.calculateRadius(a,p);else l=0;return E()({},{id:e.get("id"),type:r.getType(),extent:n,center:a,coordinates:p,radius:l,style:this.fromOlStyle(e.getStyle()),projection:this.getMapCrs()})}));return E()({},{type:"Feature",id:e.get("id"),style:this.fromOlStyle(e.getStyle()),geometry:{type:"GeometryCollection",geometries:n},projection:i})})),Ho(this,"reprojectCoordinatesToWGS84",((e,t)=>{let o=(0,L.reproject)(e,t,"EPSG:4326");return[o.x,o.y]})),Ho(this,"toOlFeature",(e=>Yt()(this.drawSource.getFeatures().filter((t=>t.get("id")===e.id))))),Ho(this,"fromOlStyle",(e=>e?{fillColor:this.rgbToHex(e.getFill().getColor()),fillTransparency:e.getFill().getColor()[3],strokeColor:e.getStroke().getColor(),strokeWidth:e.getStroke().getWidth(),text:e.getText().getText()}:{})),Ho(this,"toOlStyle",((e,t,o)=>{let r=e&&e.fillColor?e.fillColor:[255,255,255,.2];"string"==typeof r&&(r=this.hexToRgb(r).concat([e.fillOpacity>=0&&e.fillOpacity<=1?e.fillOpacity:1])),e&&e.fillTransparency&&(r[3]=e.fillTransparency);let i=e&&(e.strokeColor||e.color)?e.strokeColor||e.color:"#ffcc33";t&&(i="#4a90e2"),i=this.hexToRgb(i).concat([e&&e.opacity||1]);let s=new He.default({fill:new qe.default({color:r}),stroke:new Ye.default({color:i,width:e&&(e.strokeWidth||e.weight)?e.strokeWidth||e.weight:2}),text:new Lo.default({text:e&&e.text?e.text:"",fill:new qe.default({color:e&&(e.strokeColor||e.color)?e.strokeColor||e.color:"#000"}),stroke:new Ye.default({color:"#fff",width:2}),font:e&&e.fontSize?e.fontSize+"px helvetica":""})});return"GeometryCollection"===o?[...(0,Pe.EC)({style:{iconGlyph:"comment",iconShape:"square",iconColor:"blue"}}),s]:e&&(e.iconUrl||e.iconGlyph)?(0,Pe.EC)({style:e}):s})),Ho(this,"hexToRgb",(e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,o,r){return t+t+o+o+r+r})));return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null})),Ho(this,"componentToHex",(e=>{var t=e.toString(16);return 1===t.length?"0"+t:t})),Ho(this,"rgbToHex",(e=>"#"+this.componentToHex(e[0])+this.componentToHex(e[1])+this.componentToHex(e[2]))),Ho(this,"addModifyInteraction",(e=>{this.modifyInteraction&&this.props.map.removeInteraction(this.modifyInteraction);const t=e&&e.options&&e.options.editFilter;this.modifyFeatureColl=new Ct.Z(Jt()(this.drawLayer.getSource().getFeatures(),t)),this.modifyInteraction=new Ro({features:this.modifyFeatureColl,condition:e=>(0,rt.Xp)(e)&&!(0,rt.Ko)(e)}),this.modifyInteraction.on("modifyend",(e=>{let t=e.features.getArray().map((e=>{let t=e.clone();if(t.getGeometry&&"GeometryCollection"===t.getGeometry().getType()&&t.getGeometry().setGeometries(this.replaceCirclesWithPolygons(t)),t.getGeometry&&t.getGeometry()&&"Circle"===t.getGeometry().getType()){let o=(0,L.reproject)(t.getGeometry().getCenter(),this.getMapCrs(),"EPSG:4326"),r=t.getGeometry().getRadius();t.setProperties({center:[o.x,o.y],radius:r}),e.setProperties({center:[o.x,o.y],radius:r}),t=this.replaceCircleWithPolygon(t.clone())}return(0,L.reprojectGeoJson)(qo.writeFeatureObject(t),this.getMapCrs(),"EPSG:4326")}));this.props.options.transformToFeatureCollection?this.props.onDrawingFeatures(t):this.props.onGeometryChanged(t,this.props.drawOwner,!1,"editing","editing")})),this.props.map.addInteraction(this.modifyInteraction)})),Ho(this,"addTranslateInteraction",(()=>{this.translateInteraction&&this.props.map.removeInteraction(this.translateInteraction),this.translateInteraction=new Oo({features:new Ct.Z(this.drawLayer.getSource().getFeatures())}),this.translateInteraction.setActive(!1),this.translateInteraction.on("translateend",(e=>{let t=e.features.getArray().map((e=>{let t=e.clone();if(t.getGeometry&&"GeometryCollection"===t.getGeometry().getType()&&t.getGeometry().setGeometries(this.replaceCirclesWithPolygons(t)),t.getGeometry&&t.getGeometry()&&"Circle"===t.getGeometry().getType()){let e=(0,L.reproject)(t.getGeometry().getCenter(),this.getMapCrs(),"EPSG:4326"),o=t.getGeometry().getRadius();t.setProperties({center:[e.x,e.y],radius:o}),t=this.replaceCircleWithPolygon(t)}return e.getProperties()&&e.getProperties().selected&&this.props.onSelectFeatures([(0,L.reprojectGeoJson)(qo.writeFeatureObject(t),this.getMapCrs(),"EPSG:4326")]),(0,L.reprojectGeoJson)(qo.writeFeatureObject(t),this.getMapCrs(),"EPSG:4326")}));this.props.options.transformToFeatureCollection?this.props.onDrawingFeatures(t):this.props.onGeometryChanged(t,this.props.drawOwner,this.props.drawOwner,!1,"Text"===this.props.drawMethod,"Circle"===this.props.drawMethod)})),this.addTranslateListener(),this.props.map.addInteraction(this.translateInteraction)})),Ho(this,"createOLGeometry",(({type:e,coordinates:t,radius:o,center:r,geometries:i,projection:s,options:n={}})=>"GeometryCollection"===e?i&&i.length?new Eo.default(i.map((e=>this.olGeomFromType({type:e.type})))):new Eo.default([]):this.olGeomFromType({type:e,coordinates:t,radius:o,center:r,projection:s,options:n}))),Ho(this,"olGeomFromType",(({type:e,coordinates:t,radius:o,center:r,projection:i,options:s})=>{let n;switch(e){case"Point":case"Marker":case"Text":n=new N.Z(t||[]);break;case"LineString":n=new A.Z(t||[]);break;case"MultiPoint":n=new D.Z(t||[]);break;case"MultiLineString":n=new R.Z(t||[]);break;case"MultiPolygon":n=new V.Z(t||[]);break;default:{let e=re()(r)?{x:r[0],y:r[1]}:r;const a=i&&!isNaN(parseFloat(o))&&e&&!se()(e.x)&&!se()(e.y)&&!isNaN(parseFloat(e.x))&&!isNaN(parseFloat(e.y));n=a?s.geodesic?(0,q.iu)(this.reprojectCoordinatesToWGS84([e.x,e.y],i),o,100).clone().transform("EPSG:4326",i):(0,q.Bb)(new H([e.x,e.y],o),100):new q.ZP(t&&re()(t[0])?t:[]),n&&a&&s.geodesic&&n.setProperties({geodesicCenter:[e.x,e.y]},!0)}}return n})),Ho(this,"convertGeometryTypeToStyleType",(e=>{switch(e){case"BBOX":return"LineString";default:return e}})),Ho(this,"appendToMultiGeometry",((e,t,o)=>{switch(e){case"MultiPoint":t.appendPoint(o);break;case"MultiLineString":t.appendLineString(o);break;case"MultiPolygon":{let e=o.getCoordinates();e[0].push(e[0][0]),o.setCoordinates(e),t.appendPolygon(o);break}}})),Ho(this,"calculateRadius",((e,t)=>re()(t)&&re()(t[0])&&re()(t[0][0])?Math.sqrt(Math.pow(e[0]-t[0][0][0],2)+Math.pow(e[1]-t[0][0][1],2)):100)),Ho(this,"polygonFromCircle",((e,t,o=100)=>(0,q.Bb)(new H(e,t),o))),Ho(this,"polygonCoordsFromCircle",((e,t,o=100)=>this.polygonFromCircle(e,t,o).getCoordinates())),Ho(this,"replaceCirclesWithPolygonsInFeatureColl",(e=>e.map((e=>"Circle"!==e.getGeometry().getType()?e:this.replaceCircleWithPolygon(e))))),Ho(this,"replaceCircleWithPolygon",(e=>{if(e.getProperties().isCircle&&"Circle"===e.getGeometry().getType()){const t=e.getGeometry().getCenter(),o=e.getGeometry().getRadius();return e.setGeometry(this.polygonFromCircle(t,o)),e}return e})),Ho(this,"replaceCirclesWithPolygons",(e=>e.getGeometry&&!e.getGeometry().getGeometries?e:e.getGeometry().getGeometries().map(((t,o)=>{if("Circle"!==t.getType())return t;if(e.getProperties()&&e.getProperties().circles&&-1!==e.getProperties().circles.indexOf(o)){const e=t.getCenter(),o=t.getRadius();return this.polygonFromCircle(e,o)}return t})))),Ho(this,"replacePolygonsWithCircles",(e=>e.getGeometry().getGeometries().map(((t,o)=>{if("Polygon"!==t.getType())return t;if(e.getProperties()&&e.getProperties().circles&&-1!==e.getProperties().circles.indexOf(o)){const e=t.getExtent(),o=(0,_.qg)(e),r=this.calculateRadius(o,t.getCoordinates());return new H(o,r)}return t})))),Ho(this,"addTranslateListener",(()=>{document.addEventListener("keydown",(e=>{e.altKey&&"AltLeft"===e.code&&this.translateInteraction.setActive(!0)})),document.addEventListener("keyup",(e=>{"AltLeft"===e.code&&this.translateInteraction.setActive(!1)}))}))}UNSAFE_componentWillReceiveProps(e){if(this.drawLayer&&this.updateFeatureStyles(e.features),!e.drawStatus&&this.selectInteraction&&this.selectInteraction.getFeatures().clear(),this.props.drawStatus!==e.drawStatus||this.props.drawMethod!==e.drawMethod||this.props.features!==e.features)switch(e.drawStatus){case"create":this.addLayer(e);break;case"start":this.addInteractions(e);break;case"drawOrEdit":this.addDrawOrEditInteractions(e);break;case"stop":this.removeDrawInteraction();break;case"replace":this.replaceFeatures(e);break;case"updateStyle":this.updateOnlyFeatureStyles(e);break;case"clean":this.clean();break;case"cleanAndContinueDrawing":this.clean(!0);break;case"endDrawing":this.endDrawing(e);break;default:return}}render(){return null}}function Xo(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Ho(Yo,"propTypes",{map:s().object,drawOwner:s().string,drawStatus:s().string,drawMethod:s().string,options:s().object,features:s().array,onChangeDrawingStatus:s().func,onGeometryChanged:s().func,onDrawStopped:s().func,onDrawingFeatures:s().func,onSelectFeatures:s().func,onEndDrawing:s().func,style:s().object}),Ho(Yo,"defaultProps",{map:null,drawOwner:null,drawStatus:null,drawMethod:null,features:null,options:{stopAfterDrawing:!0},onChangeDrawingStatus:()=>{},onGeometryChanged:()=>{},onDrawStopped:()=>{},onDrawingFeatures:()=>{},onSelectFeatures:()=>{},onEndDrawing:()=>{}});class Ko extends S().Component{constructor(...e){super(...e),Xo(this,"getLayer",(()=>{let e;return this.props.map.getLayers().forEach((t=>{this.layersFilter(t)&&(e=t)}),this),e})),Xo(this,"setSelectInteraction",(()=>{this._selectInteraction.getActive()||this._selectInteraction.setActive(!0)})),Xo(this,"createSelectInteraction",(()=>{this.createStyle(),this._selectInteraction=new Wo({layers:this.layersFilter,style:this._style,toggleCondition:rt.QC}),this._selectInteraction.on("select",this.selectionChange,this),this.props.map.addInteraction(this._selectInteraction)})),Xo(this,"selectionChange",(()=>{let e=[];this._selectInteraction.getFeatures().forEach((t=>{e.push(t.getId())})),this.props.updateHighlighted(e,"")})),Xo(this,"cleanSupport",(()=>{this._selectInteraction&&this._selectInteraction.getActive()&&(this._selectInteraction.getFeatures().clear(),this.props.updateHighlighted([],""),this._selectInteraction.setActive(!1))})),Xo(this,"layersFilter",(e=>this.props.layer&&e.get("msId")===this.props.layer)),Xo(this,"createStyle",(()=>{let e=this.props.selectedStyle,t={stroke:new Ye.default(e.stroke?e.stroke:{color:"blue",width:1}),fill:new qe.default(e.fill?e.fill:{color:"blue"})};"Point"===e.type&&(t={image:new Xe.default({...t,radius:e.radius||5})}),this._style=new He.default(t)})),Xo(this,"highlightFeatures",(e=>{let t=this.getLayer(),o=this._selectInteraction.getFeatures();o.clear(),t&&t.getSource().getFeatures().map((t=>{-1!==e.indexOf(t.getId())&&o.push(t)}),this)}))}componentDidMount(){this.createSelectInteraction(),"enabled"===this.props.status?this._selectInteraction.setActive(!0):this._selectInteraction.setActive(!1),this.props.features&&this.highlightFeatures(this.props.features)}shouldComponentUpdate(e){let t=this.props;return e.status!==t.status||e.layer!==t.layer||"update"===e.status&&e.features.toString()!==t.features.toString()}UNSAFE_componentWillUpdate(e){switch(e.status){case"enabled":this.setSelectInteraction(e);break;case"disabled":this.cleanSupport();break;case"update":this.highlightFeatures(e.features);break;default:return}}componentWillUnmount(){this._selectInteraction&&(this.cleanSupport(),this._selectInteraction.un("select",this.selectionChange,this),this.props.map.removeInteraction(this._selectInteraction),this._selectInteraction=null,this._style=null)}render(){return null}}function $o(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Xo(Ko,"propTypes",{map:s().object,layer:s().string.isRequired,status:s().oneOf(["disabled","enabled","update"]),updateHighlighted:s().func,selectedStyle:s().object,features:s().array}),Xo(Ko,"contextTypes",{messages:s().object}),Xo(Ko,"defaultProps",{status:"disabled",updateHighlighted:()=>{},selectedStyle:{type:"Point",radius:12,stroke:{width:4,color:"yellow"},fill:{color:"red"}}});class Jo extends S().Component{constructor(...e){super(...e),$o(this,"addDrawInteraction",(e=>{this.drawInteraction&&this.removeDrawInteraction();let t=new Be.Z,o=new Ue.Z({source:t,zIndex:1e6,style:new He.default({fill:new qe.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new Ye.default({color:"#ffcc33",width:2}),image:new Xe.default({radius:7,fill:new qe.default({color:"#ffcc33"})})})});this.props.map.addLayer(o);let r=new mt({source:t,type:e.selection.geomType,style:new He.default({fill:new qe.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new Ye.default({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new Xe.default({radius:5,stroke:new Ye.default({color:"rgba(0, 0, 0, 0.7)"}),fill:new qe.default({color:"rgba(255, 255, 255, 0.2)"})})})});r.on("drawstart",(e=>{this.sketchFeature=e.feature,t.clear()})),r.on("drawend",(()=>{this.updateSelectionState()})),this.props.map.addInteraction(r),this.drawInteraction=r,this.selectionLayer=o,this.setDoubleClickZoomEnabled(!1)})),$o(this,"removeDrawInteraction",(()=>{null!==this.drawInteraction&&(this.props.map.removeInteraction(this.drawInteraction),this.drawInteraction=null,this.props.map.removeLayer(this.selectionLayer),this.sketchFeature=null,setTimeout((()=>this.setDoubleClickZoomEnabled(!0)),251))})),$o(this,"updateSelectionState",(()=>{if(!this.sketchFeature)return;const e=this.sketchFeature.getGeometry().getCoordinates();let t={geomType:this.props.selection.geomType,point:"Point"===this.props.selection.geomType?[e[0],e[1]]:null,line:"LineString"===this.props.selection.geomType?e.map((e=>[e[0],e[1]])):null,polygon:"Polygon"===this.props.selection.geomType?this.sketchFeature.getGeometry().getLinearRing(0).getCoordinates().map((e=>[e[0],e[1]])):null};this.props.changeSelectionState(t)})),$o(this,"setDoubleClickZoomEnabled",(e=>{let t=this.props.map.getInteractions();for(let o=0;o<t.getLength();o++){let r=t.item(o);if(r instanceof I.Z){r.setActive(e);break}}}))}UNSAFE_componentWillReceiveProps(e){e.selection.geomType&&e.selection.geomType!==this.props.selection.geomType&&this.addDrawInteraction(e),e.selection.geomType||this.removeDrawInteraction()}render(){return null}}$o(Jo,"propTypes",{map:s().object,projection:s().string,selection:s().object,changeSelectionState:s().func}),$o(Jo,"defaultProps",{selection:{}});var Qo=o(73935),er=o.n(Qo),tr=o(26160),or=o(84081);function rr(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class ir extends S().Component{constructor(...e){super(...e),rr(this,"onPopupClose",(e=>{this.props.onPopupClose(e)})),rr(this,"renderPopups",(()=>this.preparePopups().map((({popup:e,id:t,component:o,content:r,props:i,containerStyle:s})=>{const n=e.getElement(),a=po()(o)&&or.Z[o]||o;let l;return a?l=S().isValidElement(a)&&a||S().createElement(a,i):r&&(l=tr.FP(r)?S().createElement("div",{dangerouslySetInnerHTML:{__html:r}}):r),n&&er().createPortal(S().createElement("div",{className:"map-popup-ol",key:t,onMouseUp:this.convertToClick},S().createElement("div",{className:"ol-popup-content-wrapper"},S().createElement("div",{className:"ol-popup-content",style:s},l)),S().createElement("div",{className:"ol-popup-closer",onClick:()=>this.onPopupClose(t)},"x")),n)})))),rr(this,"update",(()=>{(this._popups||[]).map((({popup:e})=>{e.setElement(e.getElement())}))})),rr(this,"convertToClick",(e=>{const t=new MouseEvent("click",{bubbles:!0});t.stopPropagation=()=>{},e.target.dispatchEvent(t)})),rr(this,"preparePopups",(()=>{const{popups:e=[],map:t}=this.props,o=t.getSize();return(this._popups||[]).forEach((({popup:e,observer:o})=>{o&&o.disconnect(),e&&t.removeOverlay(e)})),this._popups=e.map((e=>{const r=20,i=Math.round(.9*o[0])-2*r,s=Math.round(.9*o[1])-2*r,{id:n,position:{coordinates:a},className:l,maxWidth:p=i,maxHeight:h=s,autoPan:c=!1,autoPanMargin:u=r,offset:d=[0,0],autoPanAnimation:m={duration:200}}=e,g=p>i?i:p,y=h>s?s:h,f=tr.fH(n,l),v=new ze.Z({id:n,element:f,autoPan:c,offset:d,autoPanMargin:u,autoPanAnimation:m,positioning:"bottom-center",className:"ol-overlay-container ol-unselectable",position:a});t.addOverlay(v);const _=((e,t,o={})=>{let r=new MutationObserver((()=>{e.getMap().getSize()&&(e.setPosition(void 0),e.setPosition(o.coordinates))}));return r.observe(t,{attributes:!0,childList:!0,subtree:!0}),r})(v,f,{coordinates:a});return{popup:v,observer:_,containerStyle:{maxWidth:g,maxHeight:y},...e}})),this._popups})),rr(this,"stopPropagationOnPointerMove",(e=>{e.stopPropagation()}))}UNSAFE_componentWillMount(){this.props.map&&this.props.map.getOverlayContainerStopEvent().addEventListener("pointermove",this.stopPropagationOnPointerMove)}shouldComponentUpdate({popups:e}){return e!==this.props.popups}componentWillUnmount(){this.props.map&&this.props.map.getOverlayContainerStopEvent().removeEventListener("pointermove",this.stopPropagationOnPointerMove)}render(){return S().createElement("div",null,this.renderPopups())}}rr(ir,"propTypes",{map:s().object,popups:s().arrayOf(s().object),onPopupClose:s().func}),rr(ir,"defaultProps",{popups:[],onPopupClose:()=>{}});var sr=o(43033);let nr;const ar={LMap:ue,Layer:ve,Feature:Oe,MeasurementSupport:((e=[])=>{return(0,l.qC)((0,l.fw)({intl:s().object}),(0,l.WY)((({intl:e})=>!!e),r.injectIntl,(0,l.vl)({intl:p})),(0,l.x3)(["intl"],(({intl:t={}})=>e.reduce(((e={},o)=>({...e,[o]:t[o]})),{}))),(t=["intl"],(0,l.jM)((e=>a()(e,t)))));var t})(["formatNumber"])(_t),Overview:jt,ScaleBar:Ut,DrawSupport:Yo,HighlightFeatureSupport:Ko,SelectionSupport:Jo,PopupSupport:ir,BoxSelectionSupport:e=>{const{map:t,onBoxEnd:o,status:r}=e;return(0,x.useEffect)((()=>{"start"===r?(nr=new sr.Z({condition:function(e){return e.originalEvent.altKey}}),t.addInteraction(nr)):"end"===r&&t.removeInteraction(nr)}),[r]),(0,x.useEffect)((()=>{nr&&nr.on("boxend",(e=>{o({boxExtent:nr.getGeometry().getExtent(),modifiers:{ctrl:e.mapBrowserEvent.pointerEvent.ctrlKey,metaKey:e.mapBrowserEvent.pointerEvent.metaKey}})}))}),[r]),null}}},14976:(e,t,o)=>{"use strict";o.d(t,{Z:()=>s});var r=o(23645),i=o.n(r)()((function(e){return e[1]}));i.push([e.id,".fgjson-app .ol-control button:hover, .fgjson-app .ol-control button:focus {\r\n    background-color: #f4f4f4;\r\n}\r\n.fgjson-app .ol-zoom .ol-zoom-out, .fgjson-app .ol-zoom .ol-zoom-in{\r\n    width: 26px;\r\n    height: 26px;\r\n    line-height: 26px;\r\n    display: block;\r\n\r\n    color: black;\r\n    background-color: #fff;\r\n    border-width: 0;\r\n    margin:0;\r\n}\r\n.fgjson-app .ol-zoom.ol-unselectable.ol-control .ol-zoom-in, .fgjson-app .ol-zoom.ol-unselectable.ol-control .ol-zoom-out {\r\n    font-family: 'Lucida Console', Monaco, monospace;\r\n    text-align: center;\r\n    text-decoration: none;\r\n    font-weight: bold;\r\n}\r\n\r\n.fgjson-app .ol-zoom .ol-zoom-out{\r\n    font-size: 18px;\r\n    border-radius: 0 0 4px 4px;\r\n}\r\n.fgjson-app .ol-zoom .ol-zoom-in{\r\n    border-bottom: 1px solid #ccc;\r\n    border-radius: 4px 4px 0 0;\r\n    font-size: 20px;\r\n}\r\n.fgjson-app .ol-zoom.ol-unselectable.ol-control{\r\n    top:10px;\r\n    left:10px;\r\n    padding:0;\r\n    box-shadow: rgba(0, 0, 0, 0.65098) 0px 1px 5px 0px;\r\n    border-radius: 4px;\r\n}\r\n\r\n.fgjson-app .ol-scale-line.ol-unselectable{\r\n    background-color: rgba(255, 255, 255, 0.8);\r\n}\r\n",""]);const s=i},57641:(e,t,o)=>{"use strict";o.d(t,{Z:()=>s});var r=o(23645),i=o.n(r)()((function(e){return e[1]}));i.push([e.id,".fgjson-app .ol-custom-overviewmap,\r\n       .fgjson-app .ol-custom-overviewmap.ol-uncollapsible {\r\n          bottom: 20px;\r\n          left: auto;\r\n          right: 10px;\r\n          top: auto;\r\n\r\n      }\r\n      .fgjson-app .ol-custom-overviewmap:not(.ol-collapsed)  {\r\n\r\n           box-shadow: 0 1px 5px rgba(0,0,0,0.65);\r\n           border-radius: 1px;\r\n           transition: all .2s;\r\n      }\r\n      .fgjson-app .ol-custom-overviewmap .ol-overviewmap-map {\r\n          border: none;\r\n          width: 300px;\r\n          height: 150px;\r\n\r\n      }\r\n\r\n      .fgjson-app .ol-custom-overviewmap .ol-overviewmap-box {\r\n          border: 1px solid black;\r\n          cursor: pointer;\r\n          border-radius: 5px;\r\n      }\r\n\r\n      .fgjson-app .ol-custom-overviewmap:not(.ol-collapsed) button{\r\n          bottom: auto;\r\n          left: auto;\r\n          right: 2px;\r\n          bottom: 2px;\r\n      }\r\n\r\n      .fgjson-app .ol-rotate {\r\n          top: 170px;\r\n          right: 0;\r\n      }\r\n      .fgjson-app .ol-overview-dargbox{\r\n           border: 1px solid black;\r\n           background-color: rgba(125,125,0,.5);\r\n           border-radius: 5px;\r\n      }\r\n",""]);const s=i},91133:(e,t,o)=>{"use strict";o.d(t,{Z:()=>s});var r=o(23645),i=o.n(r)()((function(e){return e[1]}));i.push([e.id,'.fgjson-app .ol-box {\n  box-sizing: border-box;\n  border-radius: 2px;\n  border: 2px solid blue;\n}\n\n.fgjson-app .ol-mouse-position {\n  top: 8px;\n  right: 8px;\n  position: absolute;\n}\n\n.fgjson-app .ol-scale-line {\n  background: rgba(0,60,136,0.3);\n  border-radius: 4px;\n  bottom: 8px;\n  left: 8px;\n  padding: 2px;\n  position: absolute;\n}\n.fgjson-app .ol-scale-line-inner {\n  border: 1px solid #eee;\n  border-top: none;\n  color: #eee;\n  font-size: 10px;\n  text-align: center;\n  margin: 1px;\n  will-change: contents, width;\n}\n.fgjson-app .ol-overlay-container {\n  will-change: left,right,top,bottom;\n}\n\n.fgjson-app .ol-unsupported {\n  display: none;\n}\n.fgjson-app .ol-viewport, .fgjson-app .ol-unselectable {\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  -webkit-tap-highlight-color: rgba(0,0,0,0);\n}\n.fgjson-app .ol-selectable {\n  -webkit-touch-callout: default;\n  -webkit-user-select: text;\n  -moz-user-select: text;\n  -ms-user-select: text;\n  user-select: text;\n}\n.fgjson-app .ol-grabbing {\n  cursor: -webkit-grabbing;\n  cursor: -moz-grabbing;\n  cursor: grabbing;\n}\n.fgjson-app .ol-grab {\n  cursor: move;\n  cursor: -webkit-grab;\n  cursor: -moz-grab;\n  cursor: grab;\n}\n.fgjson-app .ol-control {\n  position: absolute;\n  background-color: rgba(255,255,255,0.4);\n  border-radius: 4px;\n  padding: 2px;\n}\n.fgjson-app .ol-control:hover {\n  background-color: rgba(255,255,255,0.6);\n}\n.fgjson-app .ol-zoom {\n  top: .5em;\n  left: .5em;\n}\n.fgjson-app .ol-rotate {\n  top: .5em;\n  right: .5em;\n  transition: opacity .25s linear, visibility 0s linear;\n}\n.fgjson-app .ol-rotate.ol-hidden {\n  opacity: 0;\n  visibility: hidden;\n  transition: opacity .25s linear, visibility 0s linear .25s;\n}\n.fgjson-app .ol-zoom-extent {\n  top: 4.643em;\n  left: .5em;\n}\n.fgjson-app .ol-full-screen {\n  right: .5em;\n  top: .5em;\n}\n@media print {\n  .fgjson-app .ol-control {\n    display: none;\n  }\n}\n\n.fgjson-app .ol-control button {\n  display: block;\n  margin: 1px;\n  padding: 0;\n  color: white;\n  font-size: 1.14em;\n  font-weight: bold;\n  text-decoration: none;\n  text-align: center;\n  height: 1.375em;\n  width: 1.375em;\n  line-height: .4em;\n  background-color: rgba(0,60,136,0.5);\n  border: none;\n  border-radius: 2px;\n}\n.fgjson-app .ol-control button::-moz-focus-inner {\n  border: none;\n  padding: 0;\n}\n.fgjson-app .ol-zoom-extent button {\n  line-height: 1.4em;\n}\n.fgjson-app .ol-compass {\n  display: block;\n  font-weight: normal;\n  font-size: 1.2em;\n  will-change: transform;\n}\n.fgjson-app .ol-touch .ol-control button {\n  font-size: 1.5em;\n}\n.fgjson-app .ol-touch .ol-zoom-extent {\n  top: 5.5em;\n}\n.fgjson-app .ol-control button:hover,\n.fgjson-app .ol-control button:focus {\n  text-decoration: none;\n  background-color: rgba(0,60,136,0.7);\n}\n.fgjson-app .ol-zoom .ol-zoom-in {\n  border-radius: 2px 2px 0 0;\n}\n.fgjson-app .ol-zoom .ol-zoom-out {\n  border-radius: 0 0 2px 2px;\n}\n\n\n.fgjson-app .ol-attribution {\n  text-align: right;\n  bottom: .5em;\n  right: .5em;\n  max-width: calc(100% - 1.3em);\n}\n\n.fgjson-app .ol-attribution ul {\n  margin: 0;\n  padding: 0 .5em;\n  font-size: .7rem;\n  line-height: 1.375em;\n  color: #000;\n  text-shadow: 0 0 2px #fff;\n}\n.fgjson-app .ol-attribution li {\n  display: inline;\n  list-style: none;\n  line-height: inherit;\n}\n.fgjson-app .ol-attribution li:not(:last-child):after {\n  content: " ";\n}\n.fgjson-app .ol-attribution img {\n  max-height: 2em;\n  max-width: inherit;\n  vertical-align: middle;\n}\n.fgjson-app .ol-attribution ul, .fgjson-app .ol-attribution button {\n  display: inline-block;\n}\n.fgjson-app .ol-attribution.ol-collapsed ul {\n  display: none;\n}\n.fgjson-app .ol-attribution:not(.ol-collapsed) {\n  background: rgba(255,255,255,0.8);\n}\n.fgjson-app .ol-attribution.ol-uncollapsible {\n  bottom: 0;\n  right: 0;\n  border-radius: 4px 0 0;\n  height: 1.1em;\n  line-height: 1em;\n}\n.fgjson-app .ol-attribution.ol-uncollapsible img {\n  margin-top: -.2em;\n  max-height: 1.6em;\n}\n.fgjson-app .ol-attribution.ol-uncollapsible button {\n  display: none;\n}\n\n.fgjson-app .ol-zoomslider {\n  top: 4.5em;\n  left: .5em;\n  height: 200px;\n}\n.fgjson-app .ol-zoomslider button {\n  position: relative;\n  height: 10px;\n}\n\n.fgjson-app .ol-touch .ol-zoomslider {\n  top: 5.5em;\n}\n\n.fgjson-app .ol-overviewmap {\n  left: 0.5em;\n  bottom: 0.5em;\n}\n.fgjson-app .ol-overviewmap.ol-uncollapsible {\n  bottom: 0;\n  left: 0;\n  border-radius: 0 4px 0 0;\n}\n.fgjson-app .ol-overviewmap .ol-overviewmap-map,\n.fgjson-app .ol-overviewmap button {\n  display: inline-block;\n}\n.fgjson-app .ol-overviewmap .ol-overviewmap-map {\n  border: 1px solid #7b98bc;\n  height: 150px;\n  margin: 2px;\n  width: 150px;\n}\n.fgjson-app .ol-overviewmap:not(.ol-collapsed) button{\n  bottom: 1px;\n  left: 2px;\n  position: absolute;\n}\n.fgjson-app .ol-overviewmap.ol-collapsed .ol-overviewmap-map,\n.fgjson-app .ol-overviewmap.ol-uncollapsible button {\n  display: none;\n}\n.fgjson-app .ol-overviewmap:not(.ol-collapsed) {\n  background: rgba(255,255,255,0.8);\n}\n.fgjson-app .ol-overviewmap-box {\n  border: 2px dotted rgba(0,60,136,0.7);\n}\n\n.fgjson-app .ol-overviewmap .ol-overviewmap-box:hover {\n  cursor: move;\n}\n',""]);const s=i},80760:(e,t,o)=>{var r=o(89881);e.exports=function(e,t){var o=[];return r(e,(function(e,r,i){t(e,r,i)&&o.push(e)})),o}},89179:(e,t,o)=>{var r=o(55639),i=o(40554),s=o(14841),n=o(79833),a=r.isFinite,l=Math.min;e.exports=function(e){var t=Math[e];return function(e,o){if(e=s(e),(o=null==o?0:l(i(o),292))&&a(e)){var r=(n(e)+"e").split("e"),p=t(r[0]+"e"+(+r[1]+o));return+((r=(n(p)+"e").split("e"))[0]+"e"+(+r[1]-o))}return t(e)}}},57043:(e,t,o)=>{var r=o(62488),i=o(21078),s=o(278),n=o(1469);e.exports=function(){var e=arguments.length;if(!e)return[];for(var t=Array(e-1),o=arguments[0],a=e;a--;)t[a-1]=arguments[a];return r(n(o)?s(o):[o],i(t,1))}},43624:(e,t,o)=>{var r=o(14259),i=o(40554);e.exports=function(e,t,o){var s=null==e?0:e.length;return s?(t=o||void 0===t?1:i(t),r(e,0,(t=s-t)<0?0:t)):[]}},63105:(e,t,o)=>{var r=o(34963),i=o(80760),s=o(67206),n=o(1469);e.exports=function(e,t){return(n(e)?r:i)(e,s(t,3))}},97398:(e,t,o)=>{var r=o(55639).isFinite;e.exports=function(e){return"number"==typeof e&&r(e)}},59854:(e,t,o)=>{var r=o(89179)("round");e.exports=r},55691:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>n});var r=o(93379),i=o.n(r),s=o(57641);i()(s.Z,{insert:"head",singleton:!1});const n=s.Z.locals||{}}}]);